library(dplyr)
library(tidyr)
set.seed(123)
# Simulamos 100 rÃ©plicas del MISMO experimento
n_replicas <- 100
n_muestra <- 30
efecto_real <- 0.3  # Efecto pequeÃ±o-moderado
replicas <- tibble(
replica = 1:n_replicas
) %>%
rowwise() %>%
mutate(
p_valor = t.test(rnorm(n_muestra, efecto_real, 1), mu = 0)$p.value
) %>%
ungroup() %>%
mutate(
significativo = p_valor < 0.05,
color = ifelse(significativo, "#e74c3c", "#3498db")
)
# Conteo
n_sig <- sum(replicas$significativo)
n_no_sig <- n_replicas - n_sig
plot_ly(replicas, x = ~replica, y = ~p_valor) %>%
add_bars(
color = ~significativo,
colors = c("TRUE" = "#e74c3c", "FALSE" = "#3498db"),
hovertemplate = "RÃ©plica %{x}<br>p = %{y:.4f}<extra></extra>"
) %>%
add_trace(
y = rep(0.05, n_replicas),
x = ~replica,
type = "scatter",
mode = "lines",
line = list(dash = "dash", color = "#2c3e50", width = 2),
name = "Î± = 0.05",
hoverinfo = "skip"
) %>%
layout(
title = list(
text = paste0(
"<b>La Danza de los p-valores</b><br>",
"<sup>100 rÃ©plicas del mismo experimento (efecto real d=0.3, n=30)<br>",
"Significativos: ", n_sig, " | No significativos: ", n_no_sig, "</sup>"
)
),
xaxis = list(title = "NÃºmero de rÃ©plica"),
yaxis = list(title = "Valor p", range = c(0, 1)),
showlegend = FALSE,
annotations = list(
list(
x = 50, y = 0.85,
text = "ğŸ² Â¡Mismo experimento,<br>resultados opuestos!",
showarrow = FALSE,
font = list(size = 14)
)
)
)
#| label: fig-funnel
#| fig-cap: "El Embudo: la incertidumbre se estrecha, el p-valor colapsa"
library(plotly)
library(dplyr)
set.seed(42)
efecto <- 0.1
datos <- tibble(N = seq(20, 5000, by = 20)) %>%
rowwise() %>%
mutate(
muestra = list(rnorm(N, efecto, 1)),
test = list(t.test(muestra, mu = 0)),
media = mean(muestra),
ee = sd(muestra)/sqrt(N),
ic_low = media - 1.96*ee,
ic_high = media + 1.96*ee,
p_valor = test$p.value
) %>%
ungroup()
plot_ly(datos) %>%
# Banda del IC
add_ribbons(
x = ~N, ymin = ~ic_low, ymax = ~ic_high,
fillcolor = "rgba(52, 152, 219, 0.3)",
line = list(color = "transparent"),
name = "IC 95%"
) %>%
# LÃ­nea de la media
add_lines(
x = ~N, y = ~media,
line = list(color = "#2c3e50", width = 2),
name = "Media observada"
) %>%
# LÃ­nea del efecto real
add_lines(
x = ~N, y = rep(efecto, nrow(datos)),
line = list(dash = "dash", color = "#27ae60", width = 2),
name = "Efecto real (d=0.1)"
) %>%
# LÃ­nea de H0
add_lines(
x = ~N, y = rep(0, nrow(datos)),
line = list(dash = "dot", color = "#e74c3c", width = 2),
name = "Hâ‚€: Î¼ = 0"
) %>%
layout(
title = "<b>El Embudo de la PrecisiÃ³n</b><br><sup>El IC se estrecha hasta excluir el cero</sup>",
xaxis = list(title = "TamaÃ±o muestral (N)"),
yaxis = list(title = "EstimaciÃ³n del efecto"),
hovermode = "x unified"
)
#| label: fig-power-curves
#| fig-cap: "Curvas de poder: con suficiente N, cualquier efecto se detecta"
library(plotly)
library(dplyr)
library(pwr)
# Calcular poder para diferentes combinaciones de N y efecto
efectos <- c(0.01, 0.05, 0.1, 0.2, 0.5)
Ns <- seq(10, 10000, by = 50)
datos_poder <- expand.grid(d = efectos, N = Ns) %>%
as_tibble() %>%
rowwise() %>%
mutate(
poder = pwr.t.test(n = N, d = d, sig.level = 0.05, type = "one.sample")$power
) %>%
ungroup() %>%
mutate(
efecto_label = paste0("d = ", d),
efecto_label = factor(efecto_label, levels = paste0("d = ", efectos))
)
# Encontrar N necesario para 80% de poder en cada efecto
n_80 <- datos_poder %>%
group_by(d) %>%
filter(poder >= 0.8) %>%
slice(1) %>%
ungroup()
plot_ly(datos_poder, x = ~N, y = ~poder, color = ~efecto_label) %>%
add_lines(line = list(width = 3)) %>%
add_trace(
y = rep(0.8, length(Ns)),
x = Ns,
type = "scatter",
mode = "lines",
line = list(dash = "dash", color = "gray", width = 1),
name = "Poder = 80%",
inherit = FALSE
) %>%
layout(
title = "<b>Curvas de Poder EstadÃ­stico</b><br><sup>Todo efecto alcanza 'significaciÃ³n' con suficiente N</sup>",
xaxis = list(title = "TamaÃ±o muestral (N)", type = "log"),
yaxis = list(title = "Poder (1 - Î²)", range = c(0, 1)),
hovermode = "x unified",
legend = list(title = list(text = "TamaÃ±o del efecto"))
)
#| label: fig-forking-paths
#| fig-cap: "El jardÃ­n de senderos que se bifurcan: cada decisiÃ³n genera un p-valor diferente"
library(plotly)
library(dplyr)
set.seed(42)
# Simulamos UN dataset
n <- 100
datos_raw <- tibble(
x = rnorm(n),
y = 0.1 * x + rnorm(n),  # RelaciÃ³n dÃ©bil real
grupo = sample(c("A", "B"), n, replace = TRUE),
outlier = abs(y) > 2
)
# Diferentes "decisiones" del investigador
decisiones <- tibble(
decision = c(
"Datos completos",
"Sin outliers",
"Solo grupo A",
"Solo grupo B",
"Sin outliers + Solo A",
"Log-transformado",
"CorrelaciÃ³n Spearman",
"Test unilateral"
),
p_valor = c(
cor.test(datos_raw$x, datos_raw$y)$p.value,
cor.test(datos_raw$x[!datos_raw$outlier], datos_raw$y[!datos_raw$outlier])$p.value,
cor.test(datos_raw$x[datos_raw$grupo == "A"], datos_raw$y[datos_raw$grupo == "A"])$p.value,
cor.test(datos_raw$x[datos_raw$grupo == "B"], datos_raw$y[datos_raw$grupo == "B"])$p.value,
cor.test(datos_raw$x[!datos_raw$outlier & datos_raw$grupo == "A"],
datos_raw$y[!datos_raw$outlier & datos_raw$grupo == "A"])$p.value,
cor.test(log(abs(datos_raw$x) + 1), datos_raw$y)$p.value,
cor.test(datos_raw$x, datos_raw$y, method = "spearman")$p.value,
cor.test(datos_raw$x, datos_raw$y, alternative = "greater")$p.value
)
) %>%
mutate(
significativo = p_valor < 0.05,
decision = factor(decision, levels = decision[order(p_valor, decreasing = TRUE)])
)
plot_ly(decisiones, y = ~decision, x = ~p_valor) %>%
add_bars(
orientation = "h",
color = ~significativo,
colors = c("TRUE" = "#e74c3c", "FALSE" = "#3498db"),
hovertemplate = "%{y}<br>p = %{x:.4f}<extra></extra>"
) %>%
add_trace(
x = rep(0.05, nrow(decisiones)),
y = ~decision,
type = "scatter",
mode = "lines",
line = list(dash = "dash", color = "#2c3e50", width = 2),
name = "Î± = 0.05",
hoverinfo = "skip"
) %>%
layout(
title = "<b>El JardÃ­n de Senderos que se Bifurcan</b><br><sup>Mismo dataset, diferentes 'decisiones analÃ­ticas'</sup>",
xaxis = list(title = "Valor p", range = c(0, 0.5)),
yaxis = list(title = ""),
showlegend = FALSE
)
#| label: fig-chi-cuadrado-n
#| fig-cap: "Misma proporciÃ³n, diferente 'verdad estadÃ­stica': el p-valor como funciÃ³n de N"
library(plotly)
library(dplyr)
set.seed(123)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PARÃMETROS: Diferencia TRIVIAL entre dos tratamientos
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
p_tratamiento <- 0.51
p_control <- 0.49
diferencia <- p_tratamiento - p_control  # Solo 2%
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SIMULACIÃ“N: Chi-cuadrado para diferentes tamaÃ±os muestrales
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
datos <- tibble(
N_por_grupo = seq(50, 50000, by = 100)
) %>%
mutate(
N_total = N_por_grupo * 2,
# Ã‰xitos esperados en cada grupo (proporciones fijas)
exitos_trat = round(N_por_grupo * p_tratamiento),
fracasos_trat = N_por_grupo - exitos_trat,
exitos_ctrl = round(N_por_grupo * p_control),
fracasos_ctrl = N_por_grupo - exitos_ctrl,
# Test Chi-cuadrado
p_valor = map_dbl(1:n(), function(i) {
tabla <- matrix(
c(exitos_trat[i], fracasos_trat[i],
exitos_ctrl[i], fracasos_ctrl[i]),
nrow = 2, byrow = TRUE
)
chisq.test(tabla, correct = FALSE)$p.value
}),
# ClasificaciÃ³n
significativo = case_when(
p_valor < 0.001 ~ "p < 0.001 â­â­â­",
p_valor < 0.01 ~ "p < 0.01 â­â­",
p_valor < 0.05 ~ "p < 0.05 â­",
TRUE ~ "No significativo"
)
)
#| label: fig-chi-tabla
#| fig-cap: "Observa cÃ³mo la misma proporciÃ³n genera diferentes 'conclusiones'"
library(plotly)
library(dplyr)
# ParÃ¡metros
p_trat <- 0.51
p_ctrl <- 0.49
# Puntos especÃ­ficos para mostrar
puntos_clave <- tibble(
N_grupo = c(50, 100, 500, 1000, 5000, 10000, 25000),
N_total = N_grupo * 2
) %>%
mutate(
# Tabla 2x2
a = round(N_grupo * p_trat),   # Ã‰xitos tratamiento
b = N_grupo - a,               # Fracasos tratamiento
c = round(N_grupo * p_ctrl),   # Ã‰xitos control
d = N_grupo - c,               # Fracasos control
# Proporciones observadas (siempre ~iguales)
prop_trat = round(a / N_grupo * 100, 1),
prop_ctrl = round(c / N_grupo * 100, 1),
# Chi-cuadrado
chi_test = map(1:n(), function(i) {
tabla <- matrix(c(a[i], b[i], c[i], d[i]), nrow = 2)
chisq.test(tabla, correct = FALSE)
}),
chi_stat = map_dbl(chi_test, ~.x$statistic),
p_valor = map_dbl(chi_test, ~.x$p.value),
# InterpretaciÃ³n
conclusion = case_when(
p_valor >= 0.05 ~ "No significativo",
p_valor >= 0.01 ~ "Significativo *",
p_valor >= 0.001 ~ "Muy significativo **",
TRUE ~ "Altamente significativo ***"
),
# Color
color = case_when(
p_valor >= 0.05 ~ "#3498db",
p_valor >= 0.01 ~ "#f39c12",
p_valor >= 0.001 ~ "#e74c3c",
TRUE ~ "#8e44ad"
)
)
#| label: fig-tabla-contingencia
#| fig-cap: "La tabla de contingencia crece, la proporciÃ³n permanece igual"
library(plotly)
library(dplyr)
library(purrr)
# Crear datos para diferentes N
crear_frame <- function(n_grupo) {
p_trat <- 0.51
p_ctrl <- 0.49
a <- round(n_grupo * p_trat)
b <- n_grupo - a
c <- round(n_grupo * p_ctrl)
d <- n_grupo - c
tabla <- matrix(c(a, b, c, d), nrow = 2, byrow = TRUE)
test <- chisq.test(tabla, correct = FALSE)
tibble(
N_grupo = n_grupo,
N_total = n_grupo * 2,
exitos_trat = a,
fracasos_trat = b,
exitos_ctrl = c,
fracasos_ctrl = d,
prop_trat = round(a/n_grupo * 100, 1),
prop_ctrl = round(c/n_grupo * 100, 1),
chi_stat = test$statistic,
p_valor = test$p.value
)
}
# Generar frames para animaciÃ³n
Ns <- c(25, 50, 100, 250, 500, 1000, 2500, 5000, 10000, 25000)
datos_frames <- map_dfr(Ns, crear_frame)
# Tabla resumen bonita
tabla_html <- datos_frames %>%
mutate(
p_formato = case_when(
p_valor < 0.001 ~ "<0.001 ***",
p_valor < 0.01 ~ paste0(round(p_valor, 4), " **"),
p_valor < 0.05 ~ paste0(round(p_valor, 4), " *"),
TRUE ~ as.character(round(p_valor, 4))
),
conclusion = case_when(
p_valor >= 0.05 ~ "âŒ No rechazar Hâ‚€",
TRUE ~ "âœ… Rechazar Hâ‚€"
)
) %>%
select(
`N por grupo` = N_grupo,
`Ã‰xitos Trat.` = exitos_trat,
`Ã‰xitos Ctrl.` = exitos_ctrl,
`% Trat.` = prop_trat,
`% Ctrl.` = prop_ctrl,
`Ï‡Â²` = chi_stat,
`Valor p` = p_formato,
`ConclusiÃ³n` = conclusion
)
# Mostrar tabla con DT
library(DT)
datatable(
tabla_html,
options = list(
pageLength = 10,
dom = 't',
ordering = FALSE
),
rownames = FALSE,
caption = "Misma diferencia proporcional (â‰ˆ2%), diferente 'significaciÃ³n estadÃ­stica'"
) %>%
formatRound(columns = c("Ï‡Â²"), digits = 2) %>%
formatStyle(
"ConclusiÃ³n",
backgroundColor = styleEqual(
c("âŒ No rechazar Hâ‚€", "âœ… Rechazar Hâ‚€"),
c("#fadbd8", "#d5f5e3")
)
) %>%
formatStyle(
"Valor p",
color = styleInterval(
c(0.001, 0.01, 0.05),
c("#8e44ad", "#e74c3c", "#f39c12", "#3498db")
),
fontWeight = "bold"
)
#| label: fig-animacion-chi
#| fig-cap: "Presiona Play: observa cÃ³mo el p-valor colapsa"
library(plotly)
library(dplyr)
p_trat <- 0.51
p_ctrl <- 0.49
# Datos para animaciÃ³n
datos <- tibble(N_grupo = seq(50, 25000, by = 50)) %>%
mutate(
frame = N_grupo,
a = round(N_grupo * p_trat),
c = round(N_grupo * p_ctrl),
p_valor = map_dbl(1:n(), function(i) {
tabla <- matrix(c(a[i], N_grupo[i]-a[i], c[i], N_grupo[i]-c[i]), nrow = 2)
chisq.test(tabla, correct = FALSE)$p.value
}),
sig = ifelse(p_valor < 0.05, "Significativo", "No significativo")
)
# Datos acumulativos para cada frame
datos_acum <- map_dfr(unique(datos$frame), function(f) {
datos %>%
filter(N_grupo <= f) %>%
mutate(frame = f)
})
plot_ly(
datos_acum,
x = ~N_grupo * 2,
y = ~p_valor,
frame = ~frame
) %>%
add_trace(
type = "scatter",
mode = "lines",
line = list(color = "#3498db", width = 4)
) %>%
add_trace(
type = "scatter",
mode = "lines",
y = rep(0.05, nrow(datos_acum)),
x = ~N_grupo * 2,
line = list(dash = "dash", color = "#e74c3c", width = 2),
inherit = FALSE
) %>%
layout(
title = "<b>El Colapso del Valor p</b>",
xaxis = list(title = "N total", range = c(0, 50000)),
yaxis = list(title = "Valor p", type = "log", range = c(-6, 0)),
showlegend = FALSE
) %>%
animation_opts(
frame = 50,
transition = 0,
redraw = FALSE
) %>%
animation_slider(
currentvalue = list(
prefix = "N por grupo: ",
font = list(color = "#2c3e50", size = 14)
)
) %>%
animation_button(
x = 0.1, y = 0,
label = "â–¶ï¸ Aumentar N"
)
blogdown:::serve_site()
install.packages("gganimate")
library(ggplot2)
library(dplyr)
library(gganimate)
install.packages("gganimate")
install.packages("C:/Users/maicel/Downloads/gganimate_1.0.11.zip", repos = NULL, type = "win.binary")
library(ggplot2)
library(dplyr)
library(gganimate)
# ParÃ¡metros
p_trat <- 0.51
p_ctrl <- 0.49
# Datos
datos <- tibble(N_grupo = seq(100, 20000, by = 100)) %>%
mutate(
N_total = N_grupo * 2,
exitos_trat = round(N_grupo * p_trat),
exitos_ctrl = round(N_grupo * p_ctrl),
p_valor = mapply(function(a, n) {
tabla <- matrix(c(a, n - a, round(n * p_ctrl), n - round(n * p_ctrl)), nrow = 2)
chisq.test(tabla, correct = FALSE)$p.value
}, exitos_trat, N_grupo),
significativo = ifelse(p_valor < 0.05, "p < 0.05", "p â‰¥ 0.05")
)
# GrÃ¡fico animado
p <- ggplot(datos, aes(x = N_total, y = p_valor)) +
geom_line(color = "#3498db", linewidth = 1.5) +
geom_point(aes(color = significativo), size = 3) +
geom_hline(yintercept = 0.05, linetype = "dashed", color = "#e74c3c", linewidth = 1) +
scale_color_manual(values = c("p < 0.05" = "#e74c3c", "p â‰¥ 0.05" = "#3498db")) +
scale_y_log10(
breaks = c(0.001, 0.01, 0.05, 0.1, 0.5, 1),
labels = c("0.001", "0.01", "0.05", "0.1", "0.5", "1")
) +
scale_x_continuous(labels = scales::comma) +
labs(
title = "El Colapso del Valor p",
subtitle = "Tratamiento: 51% vs Control: 49% (diferencia = 2%)",
x = "TamaÃ±o muestral total (N)",
y = "Valor p (escala log)",
color = NULL
) +
annotate(
"text", x = 15000, y = 0.08,
label = "Î± = 0.05", color = "#e74c3c", fontface = "bold"
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "bottom",
plot.title = element_text(face = "bold", hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5, color = "gray40")
) +
# AnimaciÃ³n
transition_reveal(N_total) +
ease_aes("linear")
# Renderizar
animate(p, nframes = 100, fps = 10, width = 700, height = 450,
renderer = gifski_renderer())
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown::stop_server()
unlink("public", recursive = TRUE)   # Borrar carpeta public
blogdown::build_site(local = FALSE, build_rmd = TRUE)
blogdown::serve_site()
