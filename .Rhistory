library(tidyverse)
library(kableExtra)
library(knitr)
library(ggplot2) # Para gráficos avanzados
library(DT)  # Añade esto en el chunk setup si no lo tienes
})
# 3. CONFIGURACIÓN VISUAL
knitr::opts_chunk$set(
echo = FALSE, warning = FALSE, message = FALSE,
fig.align = "center", fig.retina = 2, fig.width = 10, fig.height = 6,
dev = 'svg'
)
# TEMA GRÁFICO UNIFICADO (Para que todo se vea profesional)
theme_academico <- function() {
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold", size = 14, color = "#2c3e50"),
plot.subtitle = element_text(color = "#7f8c8d", margin = margin(b = 10)),
strip.text = element_text(face = "bold", size = 11),
legend.position = "bottom",
panel.grid.minor = element_blank()
)
}
datos_queso <- data.frame(
Año = 2000:2009,
Queso = c(29.8, 30.1, 30.5, 30.6, 31.3, 31.7, 32.6, 33.1, 32.7, 32.8),
Muertes = c(327, 456, 509, 497, 596, 573, 661, 741, 809, 717)
)
# ===============================
# Correlación espuria: Queso vs Sábanas
# ===============================
# Dataset
datos <- data.frame(
year = 2000:2009,
cheese = c(29.8, 30.1, 30.5, 30.6, 31.3, 31.7, 32.6, 33.1, 32.7, 32.8),
deaths = c(327, 456, 509, 497, 596, 573, 661, 741, 809, 717)
)
# datos %>%
# kable(col.names = c("Año", "Consumo de Queso (Lbs/persona)", "Muertes por Sábanas"),
# caption = "Datos oficiales del USDA y CDC (vía Tyler Vigen)")
# Correlación de Pearson
r <- cor(datos$cheese, datos$deaths, method = "pearson")
r2 <- r^2
# Scatter plot con ggplot
ggplot(datos, aes(x = cheese, y = deaths)) +
geom_point(size = 3, color = "#2c3e50") +
geom_smooth(method = "lm", se = FALSE, color = "#e74c3c") +
labs(title = "Gráfico 1. Consumo de queso vs. muertes por sábanas",
x = "Consumo per cápita de queso (lb/año)",
y = "Muertes por enredarse en sábanas") +
theme_academico() +
annotate("text", x = min(datos$cheese), y = max(datos$deaths),
label = paste0("r = ", round(r, 3), "\nR² = ", round(r2, 3)),
hjust = 0, vjust = 1, size = 4, color = "#34495e")
datatable(
datos,
colnames = c("Año", "Consumo de Queso (Lbs/persona)", "Muertes por Sábanas"),
caption = "Datos oficiales del USDA y CDC (vía Tyler Vigen)",
options = list(
pageLength = 10,  # Muestra todas las filas sin paginación (datos pequeños)
searching = TRUE,  # Habilita búsqueda
ordering = TRUE,   # Ordenamiento por columnas
dom = 't'          # Solo tabla, sin extras si quieres minimalista
)
)
blogdown::serve_site()
blogdown:::stop_server()
blogdown:::serve_site()
blogdown:::preview_site()
blogdown:::preview_site()
blogdown::build_site()
blogdown::build_site()
# 1. CARGA DE LIBRERÍAS (Modo Silencioso)
suppressMessages({
library(tidyverse)
library(kableExtra)
library(knitr)
library(ggplot2) # Para gráficos avanzados
library(DT)  # Añade esto en el chunk setup si no lo tienes
})
# 3. CONFIGURACIÓN VISUAL
knitr::opts_chunk$set(
echo = FALSE, warning = FALSE, message = FALSE,
fig.align = "center", fig.retina = 2, fig.width = 10, fig.height = 6,
dev = 'svg'
)
# TEMA GRÁFICO UNIFICADO (Para que todo se vea profesional)
theme_academico <- function() {
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold", size = 14, color = "#2c3e50"),
plot.subtitle = element_text(color = "#7f8c8d", margin = margin(b = 10)),
strip.text = element_text(face = "bold", size = 11),
legend.position = "bottom",
panel.grid.minor = element_blank()
)
}
datos_queso <- data.frame(
Año = 2000:2009,
Queso = c(29.8, 30.1, 30.5, 30.6, 31.3, 31.7, 32.6, 33.1, 32.7, 32.8),
Muertes = c(327, 456, 509, 497, 596, 573, 661, 741, 809, 717)
)
# ===============================
# Correlación espuria: Queso vs Sábanas
# ===============================
# Dataset
datos <- data.frame(
year = 2000:2009,
cheese = c(29.8, 30.1, 30.5, 30.6, 31.3, 31.7, 32.6, 33.1, 32.7, 32.8),
deaths = c(327, 456, 509, 497, 596, 573, 661, 741, 809, 717)
)
# datos %>%
# kable(col.names = c("Año", "Consumo de Queso (Lbs/persona)", "Muertes por Sábanas"),
# caption = "Datos oficiales del USDA y CDC (vía Tyler Vigen)")
# Correlación de Pearson
r <- cor(datos$cheese, datos$deaths, method = "pearson")
r2 <- r^2
# Scatter plot con ggplot
ggplot(datos, aes(x = cheese, y = deaths)) +
geom_point(size = 3, color = "#2c3e50") +
geom_smooth(method = "lm", se = FALSE, color = "#e74c3c") +
labs(title = "Gráfico 1. Consumo de queso vs. muertes por sábanas",
x = "Consumo per cápita de queso (lb/año)",
y = "Muertes por enredarse en sábanas") +
theme_academico() +
annotate("text", x = min(datos$cheese), y = max(datos$deaths),
label = paste0("r = ", round(r, 3), "\nR² = ", round(r2, 3)),
hjust = 0, vjust = 1, size = 4, color = "#34495e")
blogdown::stop_server()
unlink("public", recursive = TRUE)   # Borrar carpeta public
blogdown::build_site(local = FALSE, build_rmd = TRUE)
blogdown::build_site(local = FALSE)
blogdown::build_site(local = FALSE, build_rmd = TRUE)
# Dataset
datos <- data.frame(
year = 2000:2009,
cheese = c(29.8, 30.1, 30.5, 30.6, 31.3, 31.7, 32.6, 33.1, 32.7, 32.8),
deaths = c(327, 456, 509, 497, 596, 573, 661, 741, 809, 717)
)
# Correlación
r <- cor(datos$cheese, datos$deaths, method = "pearson")
r2 <- r^2
# Scatter plot
ggplot(datos, aes(x = cheese, y = deaths)) +
geom_point(size = 3, color = "#2c3e50") +
geom_smooth(method = "lm", se = FALSE, color = "#e74c3c") +
labs(title = "Gráfico 1. Consumo de queso segun muertes por sabanas",
x = "Consumo per capita de queso (lb/ano)",
y = "Muertes por enredarse en sabanas") +
theme_academico() +
annotate("text", x = min(datos$cheese), y = max(datos$deaths),
label = paste0("r = ", round(r, 3), "\nR² = ", round(r2, 3)),
hjust = 0, vjust = 1, size = 4, color = "#34495e")
# 1. CARGA DE LIBRERÍAS
suppressMessages({
library(tidyverse)
library(kableExtra)
library(knitr)
library(ggplot2)
library(DT)
})
# 3. CONFIGURACIÓN VISUAL
knitr::opts_chunk$set(
echo = FALSE, warning = FALSE, message = FALSE,
fig.align = "center", fig.retina = 2, fig.width = 10, fig.height = 6,
dev = 'svg'
)
# TEMA GRÁFICO UNIFICADO
theme_academico <- function() {
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold", size = 14, color = "#2c3e50"),
plot.subtitle = element_text(color = "#7f8c8d", margin = margin(b = 10)),
strip.text = element_text(face = "bold", size = 11),
legend.position = "bottom",
panel.grid.minor = element_blank()
)
}
datos_queso <- data.frame(
Año = 2000:2009,
Queso = c(29.8, 30.1, 30.5, 30.6, 31.3, 31.7, 32.6, 33.1, 32.7, 32.8),
Muertes = c(327, 456, 509, 497, 596, 573, 661, 741, 809, 717)
)
blogdown::build_site(local = FALSE, build_rmd = TRUE)
blogdown::build_site(local = FALSE, build_rmd = TRUE)
blogdown::build_site(local = FALSE, build_rmd = TRUE)
# Buscar archivos con caracteres prohibidos (tildes, espacios, eñes, paréntesis)
todos_los_archivos <- list.files(path = "content", recursive = TRUE, full.names = TRUE)
prohibidos <- todos_los_archivos[grep("[^a-zA-Z0-9./_-]", todos_los_archivos)]
if(length(prohibidos) > 0) {
message("⚠️ Archivos detectados con caracteres especiales:")
print(prohibidos)
} else {
message("✅ No se detectaron caracteres especiales en los nombres.")
}
blogdown::build_site(local = FALSE, build_rmd = TRUE)
blogdown::serve_site()
blogdown::serve_site()
blogdown::build_site(local = FALSE, build_rmd = TRUE)
blogdown::serve_site()
blogdown::serve_site()
unlink("public", recursive = TRUE)   # Borrar carpeta public
blogdown::build_site(local = FALSE, build_rmd = TRUE)
blogdown::serve_site()
blogdown::serve_site()
blogdown::build_site(local = FALSE, build_rmd = TRUE)
blogdown::build_site(local = FALSE, build_rmd = TRUE)
blogdown::serve_site()
blogdown::stop_server()
blogdown::build_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
unlink("public", recursive = TRUE)   # Borrar carpeta public
blogdown::build_site(local = FALSE, build_rmd = TRUE)
blogdown:::serve_site()  # Sirve localmente para preview.
blogdown:::serve_site()  # Sirve localmente para preview.
blogdown::stop_server()
unlink("public", recursive = TRUE)   # Borrar carpeta public
blogdown::build_site(local = FALSE, build_rmd = TRUE)
blogdown::serve_site()
logdown::serve_site()
blogdown::serve_site()
library(dplyr)
library(ggplot2)
set.seed(123)
# Simulación: 100 pacientes por grupo
n <- 100
true_rate <- c(0.6, 0.65) # efecto real
datos <- data.frame(
grupo = rep(c("Control", "Tratamiento"), each=n),
exito = c(rbinom(n, 1, true_rate[1]),
rbinom(n, 1, true_rate[2]))
)
# Simulamos pérdidas no al azar (MNAR)
lost <- sample(1:(2*n), size=30, replace=FALSE)
datos$exito[lost] <- NA
# LOCF simple: rellenamos con la media del grupo
datos <- datos %>%
group_by(grupo) %>%
mutate(exito_imput = ifelse(is.na(exito), round(mean(exito, na.rm=TRUE)), exito))
# Tablas de proporciones
prop_real <- tapply(datos$exito, datos$grupo, mean, na.rm=TRUE)
prop_imput <- tapply(datos$exito_imput, datos$grupo, mean)
# Chi-cuadrado antes y después de imputación
tabla_real <- matrix(c(sum(datos$exito[datos$grupo=="Tratamiento"], na.rm=TRUE),
sum(datos$exito[datos$grupo=="Control"], na.rm=TRUE),
n - sum(datos$exito[datos$grupo=="Tratamiento"], na.rm=TRUE),
n - sum(datos$exito[datos$grupo=="Control"], na.rm=TRUE)), nrow=2)
tabla_imput <- matrix(c(sum(datos$exito_imput[datos$grupo=="Tratamiento"]),
sum(datos$exito_imput[datos$grupo=="Control"]),
n - sum(datos$exito_imput[datos$grupo=="Tratamiento"]),
n - sum(datos$exito_imput[datos$grupo=="Control"])), nrow=2)
p_real <- chisq.test(tabla_real)$p.value
p_imput <- chisq.test(tabla_imput)$p.value
# Gráfico
df_plot <- data.frame(
Grupo = c("Control", "Tratamiento"),
Real = c(prop_real["Control"], prop_real["Tratamiento"]),
Imputado = c(prop_imput["Control"], prop_imput["Tratamiento"])
)
df_plot_melt <- df_plot %>%
tidyr::pivot_longer(cols=c("Real","Imputado"), names_to="Estado", values_to="Proporcion")
ggplot(df_plot_melt, aes(x=Grupo, y=Proporcion, fill=Estado)) +
geom_bar(stat="identity", position="dodge") +
ylim(0,1) +
labs(
title="Mini-caso: Cómo LOCF altera la evidencia",
subtitle=paste0("p-valor real = ", round(p_real,3), " | p-valor imputado = ", round(p_imput,3)),
y="Proporción de éxitos",
x=""
) +
scale_fill_manual(values=c("#3498db","#e74c3c")) +
theme_minimal(base_size=13)
blogdown::stop_server()
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
unlink("public", recursive = TRUE)   # Borrar carpeta public
blogdown::build_site(local = FALSE)
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::serve_site()
library(dplyr)
library(tidyr)
library(ggplot2)
set.seed(123)
n <- 200
datos <- tibble(
id = 1:n,
grupo = rep(c("Control", "Tratamiento"), each = n/2)
)
p_true <- c(Control = 0.60, Tratamiento = 0.65)
datos <- datos %>%
mutate(y_true = rbinom(n(), 1, p_true[grupo])) %>%
mutate(
pr_lost = case_when(
grupo == "Control" & y_true == 1 ~ 0.05,
grupo == "Control" & y_true == 0 ~ 0.25,
grupo == "Tratamiento" & y_true == 1 ~ 0.05,
grupo == "Tratamiento" & y_true == 0 ~ 0.45
),
lost = rbinom(n(), 1, pr_lost),
y_obs = ifelse(lost == 1, NA, y_true)
)
# Complete-case
cc <- datos %>% filter(!is.na(y_obs))
# Imputaciones
datos <- datos %>%
mutate(
y_imp = ifelse(is.na(y_obs), round(mean(y_obs, na.rm = TRUE)), y_obs),
y_worst = case_when(
is.na(y_obs) & grupo == "Tratamiento" ~ 0,
is.na(y_obs) & grupo == "Control" ~ 1,
TRUE ~ y_obs
)
)
# Función resumen
resume <- function(df, yvar, etiqueta) {
p <- tapply(df[[yvar]], df$grupo, mean, na.rm = TRUE)
tibble(
estrategia = etiqueta,
p_control = p["Control"],
p_trat = p["Tratamiento"],
diff = p["Tratamiento"] - p["Control"]
)
}
res <- bind_rows(
resume(cc, "y_obs", "Complete-case"),
resume(datos, "y_imp", "Imputación media"),
resume(datos, "y_worst", "Worst-case")
)
res
res %>%
pivot_longer(cols = c(p_control, p_trat), names_to = "grupo", values_to = "prop") %>%
mutate(grupo = recode(grupo, p_control = "Control", p_trat = "Tratamiento")) %>%
ggplot(aes(x = estrategia, y = prop, fill = grupo)) +
geom_col(position = "dodge") +
geom_text(
data = res,
aes(x = estrategia, y = 0.02, label = paste0("Δ=", round(diff, 3))),
inherit.aes = FALSE, size = 3.6, hjust = 0
) +
coord_cartesian(ylim = c(0, 1)) +
labs(
title = "Un Solo Dataset, Tres Narrativas Divergentes",
subtitle = "Manejo de Faltantes Altera el Efecto Estimado",
x = "Estrategia de Análisis", y = "Proporción de Éxito"
) +
theme_minimal(base_size = 13)
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
unlink("public", recursive = TRUE)   # Borrar carpeta public
blogdown::build_site(local = FALSE)
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
unlink("public", recursive = TRUE)   # Borrar carpeta public
blogdown::build_site(local = FALSE)
blogdown:::serve_site()
library(dplyr)
library(tidyr)
library(ggplot2)
set.seed(123)
n <- 200
datos <- tibble(
id = 1:n,
grupo = rep(c("Control", "Tratamiento"), each = n/2)
)
p_true <- c(Control = 0.60, Tratamiento = 0.65)
datos <- datos %>%
mutate(y_true = rbinom(n(), 1, p_true[grupo])) %>%
mutate(
pr_lost = case_when(
grupo == "Control" & y_true == 1 ~ 0.05,
grupo == "Control" & y_true == 0 ~ 0.25,
grupo == "Tratamiento" & y_true == 1 ~ 0.05,
grupo == "Tratamiento" & y_true == 0 ~ 0.45
),
lost = rbinom(n(), 1, pr_lost),
y_obs = ifelse(lost == 1, NA, y_true)
)
# Complete-case
cc <- datos %>% filter(!is.na(y_obs))
# Imputaciones
datos <- datos %>%
mutate(
y_imp = ifelse(is.na(y_obs), round(mean(y_obs, na.rm = TRUE)), y_obs),
y_worst = case_when(
is.na(y_obs) & grupo == "Tratamiento" ~ 0,
is.na(y_obs) & grupo == "Control" ~ 1,
TRUE ~ y_obs
)
)
# Función resumen
resume <- function(df, yvar, etiqueta) {
p <- tapply(df[[yvar]], df$grupo, mean, na.rm = TRUE)
tibble(
estrategia = etiqueta,
p_control = p["Control"],
p_trat = p["Tratamiento"],
diff = p["Tratamiento"] - p["Control"]
)
}
res <- bind_rows(
resume(cc, "y_obs", "Complete-case"),
resume(datos, "y_imp", "Imputación media"),
resume(datos, "y_worst", "Worst-case")
)
res
res %>%
pivot_longer(cols = c(p_control, p_trat), names_to = "grupo", values_to = "prop") %>%
mutate(grupo = recode(grupo, p_control = "Control", p_trat = "Tratamiento")) %>%
ggplot(aes(x = estrategia, y = prop, fill = grupo)) +
geom_col(position = "dodge") +
geom_text(
data = res,
aes(x = estrategia, y = 0.02, label = paste0("Δ=", round(diff, 3))),
inherit.aes = FALSE, size = 3.6, hjust = 0
) +
coord_cartesian(ylim = c(0, 1)) +
labs(
title = "Un Solo Dataset, Tres Narrativas Divergentes",
subtitle = "Manejo de Faltantes Altera el Efecto Estimado",
x = "Estrategia de Análisis", y = "Proporción de Éxito"
) +
theme_minimal(base_size = 13)
library(dplyr)
library(tidyr)
library(ggplot2)
set.seed(123)
n <- 200
datos <- tibble(
id = 1:n,
grupo = rep(c("Control", "Tratamiento"), each = n/2)
)
p_true <- c(Control = 0.60, Tratamiento = 0.65)
datos <- datos %>%
mutate(y_true = rbinom(n(), 1, p_true[grupo])) %>%
mutate(
pr_lost = case_when(
grupo == "Control" & y_true == 1 ~ 0.05,
grupo == "Control" & y_true == 0 ~ 0.25,
grupo == "Tratamiento" & y_true == 1 ~ 0.05,
grupo == "Tratamiento" & y_true == 0 ~ 0.45
),
lost = rbinom(n(), 1, pr_lost),
y_obs = ifelse(lost == 1, NA, y_true)
)
# Complete-case
cc <- datos %>% filter(!is.na(y_obs))
# Imputaciones
datos <- datos %>%
mutate(
y_imp = ifelse(is.na(y_obs), round(mean(y_obs, na.rm = TRUE)), y_obs),
y_worst = case_when(
is.na(y_obs) & grupo == "Tratamiento" ~ 0,
is.na(y_obs) & grupo == "Control" ~ 1,
TRUE ~ y_obs
)
)
# Función resumen
resume <- function(df, yvar, etiqueta) {
p <- tapply(df[[yvar]], df$grupo, mean, na.rm = TRUE)
tibble(
estrategia = etiqueta,
p_control = p["Control"],
p_trat = p["Tratamiento"],
diff = p["Tratamiento"] - p["Control"]
)
}
res <- bind_rows(
resume(cc, "y_obs", "Complete-case"),
resume(datos, "y_imp", "Imputación media"),
resume(datos, "y_worst", "Worst-case")
)
res
library(knitr)
unlink("content/es/post/2025-12-30-ER-post01/index_cache", recursive = TRUE)
blogdown::serve_site()
res %>%
pivot_longer(cols = c(p_control, p_trat), names_to = "grupo", values_to = "prop") %>%
mutate(grupo = recode(grupo, p_control = "Control", p_trat = "Tratamiento")) %>%
ggplot(aes(x = estrategia, y = prop, fill = grupo)) +
geom_col(position = "dodge") +
geom_text(
data = res,
aes(x = estrategia, y = 0.02, label = paste0("Δ=", round(diff, 3))),
inherit.aes = FALSE, size = 3.6, hjust = 0
) +
coord_cartesian(ylim = c(0, 1)) +
labs(
title = "Un Solo Dataset, Tres Narrativas Divergentes",
subtitle = "Manejo de Faltantes Altera el Efecto Estimado",
x = "Estrategia de Análisis", y = "Proporción de Éxito"
) +
theme_minimal(base_size = 13)
blogdown::serve_site()
blogdown::stop_server()
blogdown::build_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
