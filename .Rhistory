axis.text.y = element_text(face = "bold", color = "black"),
axis.text.x = element_text(color = "grey20", size = 10)
)
# DENSITY PLOT (DISTRIBUTION) ------------------------------------------
# Density plot of students' data superimposed with theoretical normal
g_distribution <- ggplot(data_students, aes(x = value, color = participant, fill = participant)) +
# A. Normal limits lines
geom_vline(xintercept = c(121, 151), linetype = "dotted", color = "grey50", linewidth = 0.6) +
# B. Theoretical normal curve (reference)
stat_function(fun = dnorm, args = list(mean = mean_real, sd = sd_real),
aes(linetype = "Theoretical Normal Curve"),
color = "black", linewidth = 0.9, inherit.aes = FALSE) +
# C. Observed densities (students)
geom_density(alpha = 0.2, linewidth = 1) +
# D. Scales and colors
scale_color_manual(values = fixed_colors,
labels = c("REALITY" = "Real Biology (Reference)",
"La Confiada" = "The Confident",
"La Entusiasta" = "The Enthusiastic",
"La Prudente" = "The Prudent")) +
scale_fill_manual(values = fixed_colors,
labels = c("REALITY" = "Real Biology (Reference)",
"La Confiada" = "The Confident",
"La Entusiasta" = "The Enthusiastic",
"La Prudente" = "The Prudent")) +
scale_x_continuous(breaks = seq(100, 160, 10), limits = c(95, 160)) +
# E. Labels and theme
labs(title = "The Shape of Fraud: Distribution vs. Normality",
subtitle = "Black line: Normal reference. Dotted lines: Clinical limits (121-151).",
x = "Hemoglobin (g/L)",
y = "Density",
linetype = "", # Legend title for linetype
color = "Participant", # Legend title for color
fill = "Participant") + # Legend title for fill
theme_academic() +
theme(legend.position = "bottom")
# 6. Third test: The last digit (The trail of chaos) ------------------
# A. Calculate proportions of last digits and detect anomalies
analysis_last_digit <- data_students %>%
mutate(last_digit = factor(value %% 10, levels = 0:9)) %>%
count(participant, last_digit, .drop = FALSE) %>%
group_by(participant) %>%
mutate(
prop = n / sum(n),
is_high = abs(prop - 0.10) > 0.06
)
# B. Table with HTML format (colors for deviations)
# First prepare the table data
table_last_digit_data <- analysis_last_digit %>%
mutate(
prop_format = paste0(round(prop * 100, 1), "%"),
prop_html = ifelse(
is_high,
cell_spec(prop_format, "html", bold = TRUE, color = "red"),
prop_format
)
) %>%
select(last_digit, participant, prop_html) %>%
pivot_wider(names_from = participant, values_from = prop_html) %>%
arrange(as.numeric(as.character(last_digit))) %>%
# Rename the column for display
rename(`Last Digit` = last_digit)
# Now create the kableExtra object, without direct printing
table_last_digit_kbl <- kbl(
table_last_digit_data,
caption = "Last Digit Frequency per Participant",
escape = FALSE, # Important for HTML inside cell_spec to render
col.names = c("Last Digit", "The Enthusiastic", "The Confident", "The Prudent") # Translate column names
) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
# C. Bar plot for last digit distribution
g_last_digit <- ggplot(analysis_last_digit, aes(x = last_digit, y = prop)) +
geom_hline(yintercept = 0.10, linetype = "solid", color = "black", alpha = 0.5) +
geom_col(aes(fill = is_high), width = 0.7, color = "white") +
facet_wrap(~ participant, labeller = as_labeller(c(
"La Entusiasta" = "The Enthusiastic",
"La Confiada" = "The Confident",
"La Prudente" = "The Prudent"
))) +
scale_fill_manual(values = c("FALSE" = "gray60", "TRUE" = "firebrick"),
labels = c("Expected", "High Deviation")) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
labs(title = "Detection of Fabricated Data: Last Digit",
subtitle = "Comparison: Real Data vs. Cognitive Biases",
fill = "Status",
x = "Last Digit",
y = "Relative Frequency") +
theme_academic()
# D. Forensic diagnostic table based on deviations
table_digit_diagnostics <- analysis_last_digit %>%
group_by(participant) %>%
summarise(
Avg_Deviation = mean(abs(prop - 0.10)) * 100,
Sum_0_5      = sum(prop[last_digit %in% c(0,5)]) * 100
) %>%
mutate(
Evaluation = case_when(
Sum_0_5 > 25 ~ "Suspicious: Excess Rounding",
Sum_0_5 < 15 ~ "Suspicious: Artificial Avoidance",
Avg_Deviation > 4.0 ~ "Suspicious: Irregular Pattern",
TRUE ~ "Natural Pattern"
),
Avg_Deviation    = sprintf("%.1f%%", Avg_Deviation),
Sum_0_5         = sprintf("%.1f%%", Sum_0_5)
) %>%
select(Participant = participant,
`Avg. Deviation` = Avg_Deviation,
`Frequency 0 and 5` = Sum_0_5,
Evaluation)
# For a formatted kableExtra version (not displayed unless called)
table_digit_diagnostics_kbl <- kbl(table_digit_diagnostics, caption = "Last Digit Diagnostics") %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
# 7. Fourth test: Benford's Law (The Second Digit) ----------------------
# Note: Given the narrow hemoglobin range, we use tens frequency
# instead of full Benford to detect aversion to extremes.
# Analysis of tens digits (second digit)
analysis_tens <- data_students %>%
mutate(tens_digit = floor((value %% 100) / 10)) %>%
count(participant, tens_digit) %>%
group_by(participant) %>%
mutate(prop = n / sum(n))
# Adapted Benford plot: Bars with a smooth trend
g_benford <- ggplot(analysis_tens, aes(x = factor(tens_digit), y = prop)) +
geom_col(aes(fill = participant), color = "white", show.legend = FALSE) +
# Smooth line for trend
geom_smooth(aes(group=1), method = "loess", se = FALSE, color="black", linetype="dashed") +
facet_wrap(~ participant, scales = "free_x", labeller = as_labeller(c(
"La Entusiasta" = "The Enthusiastic",
"La Confiada" = "The Confident",
"La Prudente" = "The Prudent"
))) +
# Use fixed_colors for consistency (excluding REALITY)
scale_fill_manual(values = fixed_colors[names(fixed_colors) != "REALITY"]) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
labs(title = "Benford's Ghost: Analysis of Tens Digits",
subtitle = "Artificial 'Mountain' (Aversion to Extremes) vs. Natural Dispersion",
x = "Second Digit (Tens: 1[3]6)",
y = "Frequency") +
theme_academic()
# 7. RUNS TEST (INDEPENDENCE) -----------------------------------------
# Runs test to detect non-randomness in the sequence of values
analysis_runs <- data_students %>%
group_by(participant) %>%
summarise(
Z_Score = {
x <- value; med <- median(x); signs <- sign(x - med); signs <- signs[signs != 0]
if(length(signs) < 10) NA else { # Avoid error with too few non-zero data points
runs <- rle(signs); n1 <- sum(signs == 1); n2 <- sum(signs == -1); n <- n1 + n2
# Ensure n1 and n2 are not zero to avoid division by zero
if(n1 == 0 || n2 == 0) NA else {
mu <- 2 * n1 * n2 / n + 1
sigma <- sqrt((mu - 1) * (mu - 2) / (n - 1))
(length(runs$lengths) - mu) / sigma
}
}
}
) %>%
mutate(
Evaluation = case_when(
is.na(Z_Score) ~ "Insufficient Data/Not Calculable",
abs(Z_Score) > 1.96 ~ "Non-Random",
TRUE ~ "Random"
)
) %>%
# Rename participant column for display
rename(Participant = participant)
# Display table for runs
table_runs_display <- analysis_runs %>%
# Select the original Z_Score and other columns
select(Participant,
Z_Score, # Select the column named 'Z_Score' (with underscore)
Evaluation) %>%
# Round Z_Score and assign it to a new column named `Z-Score` (with hyphen)
mutate(`Z-Score` = round(Z_Score, 2)) %>%
# Finally, select the columns in the desired order, including the newly named `Z-Score`
select(Participant, `Z-Score`, Evaluation)
# For a formatted kableExtra version (not displayed unless called)
table_runs_kbl <- kbl(table_runs_display, caption = "Runs Test per Participant") %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
# 8. Fifth test: Distribution Analysis (Shape and Skewness) ----------------
# Prepare data with factors (includes REALITY)
data_plot_shape <- data_full %>% # Use data_full to include REALITY
mutate(participant = factor(participant,
levels = c("REALITY", "La Confiada", "La Entusiasta", "La Prudente")))
# Table of shape metrics (mean, SD, skewness, kurtosis)
table_shape <- data_plot_shape %>%
group_by(participant) %>%
summarise(
Mean = mean(value),
SD = sd(value),
Skewness = moments::skewness(value),
Kurtosis = moments::kurtosis(value)
) %>%
# Rename participant column for display
rename(Participant = participant)
# For a formatted kableExtra version (not displayed unless called)
table_shape_kbl <- kbl(table_shape, caption = "Distribution Shape Metrics") %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F) %>%
kableExtra::round_columns(2:5) # CORRECTED: Explicitly call kableExtra::round_columns()
blogdown::serve_site()
blogdown::serve_site()
blogdown:::stop_server()                              # Detiene el servidor.
unlink("public", recursive = TRUE)                    # Borrar carpeta public
blogdown::build_site(local = FALSE, build_rmd = TRUE) # Construye.
blogdown:::serve_site()                               # preview.
blogdown:::serve_site()                               # preview.
blogdown::serve_site()
blogdown::serve_site()
library(dplyr)
library(ggplot2)
set.seed(456)
n <- 100
datos <- tibble(
id = 1:n,
grupo = rep(c("Control", "Tratamiento"), each = n/2)
)
# Número de exacerbaciones por paciente (distribución Poisson)
lambda <- c(Control = 2, Tratamiento = 1.5)
datos <- datos %>%
mutate(exac = rpois(n(), lambda[grupo]),
binaria = ifelse(exac >= 1, 1, 0))
# Resumen comparativo
res <- datos %>%
group_by(grupo) %>%
summarise(
exac_media = mean(exac),
prob_al_menos_una = mean(binaria)
)
res
library(dplyr)
library(ggplot2)
set.seed(456)
n <- 100
datos <- tibble(
id = 1:n,
grupo = rep(c("Control", "Tratamiento"), each = n/2)
)
# Ajustamos lambda para ilustrar la desconexión
lambda <- c(Control = 1.0, Tratamiento = 0.5)
datos <- datos %>%
mutate(
exac = rpois(n(), lambda[grupo]),
binaria = ifelse(exac >= 1, 1, 0)
)
# Resumen para el gráfico
res <- datos %>%
group_by(grupo) %>%
summarise(
exac_media = mean(exac),
prob_al_menos_una = mean(binaria)
) %>%
pivot_longer(cols = c(exac_media, prob_al_menos_una),
names_to = "medida",
values_to = "valor") %>%
mutate(
medida = recode(medida,
exac_media = "Media de exacerbaciones",
prob_al_menos_una = "Probabilidad ≥1 exacerbación")
)
library(tidyverse)
library(ggplot2)
set.seed(456)
# library(dplyr)
# library(ggplot2)
# set.seed(456)
n <- 100
datos <- tibble(
id = 1:n,
grupo = rep(c("Control", "Tratamiento"), each = n/2)
)
# Ajustamos lambda para ilustrar la desconexión
lambda <- c(Control = 1.0, Tratamiento = 0.5)
datos <- datos %>%
mutate(
exac = rpois(n(), lambda[grupo]),
binaria = ifelse(exac >= 1, 1, 0)
)
# Resumen para el gráfico
res <- datos %>%
group_by(grupo) %>%
summarise(
exac_media = mean(exac),
prob_al_menos_una = mean(binaria)
) %>%
pivot_longer(cols = c(exac_media, prob_al_menos_una),
names_to = "medida",
values_to = "valor") %>%
mutate(
medida = recode(medida,
exac_media = "Media de exacerbaciones",
prob_al_menos_una = "Probabilidad ≥1 exacerbación")
)
# Gráfico combinado
ggplot(res, aes(x = grupo, y = valor, fill = medida)) +
geom_col(position = position_dodge(width = 0.7), width = 0.6) +
geom_text(aes(label = round(valor, 2)),
position = position_dodge(width = 0.7),
vjust = -0.5, size = 4) +
scale_fill_manual(values = c("Media de exacerbaciones" = "steelblue",
"Probabilidad ≥1 exacerbación" = "tomato")) +
labs(
title = "Fenómeno clínico vs. objetivo simplificado",
subtitle = "El efecto existe en la media, pero se atenúa si solo usamos ≥1 exacerbación",
x = "Grupo",
y = "Valor",
fill = "Medida"
) +
theme_minimal(base_size = 13) +
coord_cartesian(ylim = c(0, max(res$valor) + 0.2))
# n <- 100
# datos <- tibble(
#   id = 1:n,
#   grupo = rep(c("Control", "Tratamiento"), each = n/2)
# )
#
# # Número de exacerbaciones por paciente (distribución Poisson)
# lambda <- c(Control = 2, Tratamiento = 1.5)
# datos <- datos %>%
#   mutate(exac = rpois(n(), lambda[grupo]),
#          binaria = ifelse(exac >= 1, 1, 0))
#
# # Resumen comparativo
# res <- datos %>%
#   group_by(grupo) %>%
#   summarise(
#     exac_media = mean(exac),
#     prob_al_menos_una = mean(binaria)
#   )
#
# res
library(tidyverse)
library(ggplot2)
set.seed(456)
library(dplyr)
library(ggplot2)
set.seed(456)
n <- 100
datos <- tibble(
id = 1:n,
grupo = rep(c("Control", "Tratamiento"), each = n/2)
)
# Ajustamos lambda para que la binaria no detecte fácilmente la mejora
lambda <- c(Control = 1.0, Tratamiento = 0.5)
datos <- datos %>%
mutate(
exac = rpois(n(), lambda[grupo]),
binaria = ifelse(exac >= 1, 1, 0)
)
# Resumen comparativo
res <- datos %>%
group_by(grupo) %>%
summarise(
exac_media = mean(exac),
prob_al_menos_una = mean(binaria)
)
res
library(tidyverse)
library(ggplot2)
set.seed(456)
library(dplyr)
library(ggplot2)
set.seed(456)
n <- 100
datos <- tibble(
id = 1:n,
grupo = rep(c("Control", "Tratamiento"), each = n/2)
)
# Ajustamos lambda para que la binaria no detecte fácilmente la mejora
lambda <- c(Control = 1.5, Tratamiento = 0.5)
datos <- datos %>%
mutate(
exac = rpois(n(), lambda[grupo]),
binaria = ifelse(exac >= 1, 1, 0)
)
# Resumen comparativo
res <- datos %>%
group_by(grupo) %>%
summarise(
exac_media = mean(exac),
prob_al_menos_una = mean(binaria)
)
res
library(tidyverse)
library(ggplot2)
set.seed(456)
set.seed(456)
library(dplyr)
library(ggplot2)
set.seed(456)
n <- 100
datos <- tibble(
id = 1:n,
grupo = rep(c("Control", "Tratamiento"), each = n/2)
)
# Ajustamos lambda para que la binaria no detecte fácilmente la mejora
lambda <- c(Control = 1.5, Tratamiento = 0.5)
datos <- datos %>%
mutate(
exac = rpois(n(), lambda[grupo]),
binaria = ifelse(exac >= 1, 1, 0)
)
# Resumen comparativo
res <- datos %>%
group_by(grupo) %>%
summarise(
exac_media = mean(exac),
prob_al_menos_una = mean(binaria)
)
res
library(dplyr)
library(ggplot2)
set.seed(456)
n <- 100
datos <- tibble(
id = 1:n,
grupo = rep(c("Control", "Tratamiento"), each = n/2)
)
# Ajustamos lambda para mostrar la desconexión
lambda <- c(Control = 1.5, Tratamiento = 0.5)
datos <- datos %>%
mutate(
exac = rpois(n(), lambda[grupo]),
binaria = ifelse(exac >= 1, 1, 0)
)
# Resumen para tabla
res_tabla <- datos %>%
group_by(grupo) %>%
summarise(
exac_media = mean(exac),
prob_al_menos_una = mean(binaria)
)
res_tabla
# Preparar datos para gráfico
res_grafico <- res_tabla %>%
pivot_longer(cols = c(exac_media, prob_al_menos_una),
names_to = "medida",
values_to = "valor") %>%
mutate(
medida = recode(medida,
exac_media = "Media de exacerbaciones",
prob_al_menos_una = "Probabilidad ≥1 exacerbación")
)
# Gráfico combinado
ggplot(res_grafico, aes(x = grupo, y = valor, fill = medida)) +
geom_col(position = position_dodge(width = 0.7), width = 0.6) +
geom_text(aes(label = round(valor, 2)),
position = position_dodge(width = 0.7),
vjust = -0.5, size = 4) +
scale_fill_manual(values = c("Media de exacerbaciones" = "steelblue",
"Probabilidad ≥1 exacerbación" = "tomato")) +
labs(
title = "Fenómeno clínico vs. objetivo simplificado",
subtitle = "El efecto existe en la media, pero se atenúa si solo usamos ≥1 exacerbación",
x = "Grupo",
y = "Valor",
fill = "Medida"
) +
theme_minimal(base_size = 13) +
coord_cartesian(ylim = c(0, max(res_grafico$valor) + 0.2))
library(tidyverse)
library(ggplot2)
set.seed(456)
library(dplyr)
library(ggplot2)
set.seed(456)
n <- 100
datos <- tibble(
id = 1:n,
grupo = rep(c("Control", "Tratamiento"), each = n/2)
)
# Ajustamos lambda para mostrar la desconexión
lambda <- c(Control = 1.5, Tratamiento = 0.5)
datos <- datos %>%
mutate(
exac = rpois(n(), lambda[grupo]),
binaria = ifelse(exac >= 1, 1, 0)
)
# Resumen para tabla
res_tabla <- datos %>%
group_by(grupo) %>%
summarise(
exac_media = mean(exac),
prob_al_menos_una = mean(binaria)
)
res_tabla
# Preparar datos para gráfico
res_grafico <- res_tabla %>%
pivot_longer(cols = c(exac_media, prob_al_menos_una),
names_to = "medida",
values_to = "valor") %>%
mutate(
medida = recode(medida,
exac_media = "Media de exacerbaciones",
prob_al_menos_una = "Probabilidad ≥1 exacerbación")
)
# Gráfico combinado
ggplot(res_grafico, aes(x = grupo, y = valor, fill = medida)) +
geom_col(position = position_dodge(width = 0.7), width = 0.6) +
geom_text(aes(label = round(valor, 2)),
position = position_dodge(width = 0.7),
vjust = -0.5, size = 4) +
scale_fill_manual(values = c("Media de exacerbaciones" = "steelblue",
"Probabilidad ≥1 exacerbación" = "tomato")) +
labs(
title = "Fenómeno clínico vs. objetivo simplificado",
subtitle = "El efecto existe en la media, pero se atenúa si solo usamos ≥1 exacerbación",
x = "Grupo",
y = "Valor",
fill = "Medida"
) +
theme_minimal(base_size = 13) +
coord_cartesian(ylim = c(0, max(res_grafico$valor) + 0.2))
