filter(!is.na(segundo_digito)) %>%
group_by(participante, segundo_digito) %>%
summarise(
n_digito = n(),
.groups = 'drop'
) %>%
group_by(participante) %>%
mutate(
total_vals = sum(n_digito),
proporcion_observada = n_digito / total_vals,
# Intervalos de confianza para Benford
error_estandar = sqrt(proporcion_observada * (1 - proporcion_observada) / total_vals),
ic_lower = proporcion_observada - 1.96 * error_estandar,
ic_upper = proporcion_observada + 1.96 * error_estandar,
proporcion_esperada = benford_esperado[segundo_digito + 1],
contiene_esperado = (proporcion_esperada >= ic_lower) & (proporcion_esperada <= ic_upper),
desviacion_relativa = abs(proporcion_observada - proporcion_esperada) / proporcion_esperada
) %>%
group_by(participante) %>%
summarise(
digitos_conforme_benford = sum(contiene_esperado),
desviacion_promedio_benford = mean(desviacion_relativa),
evaluacion_benford = case_when(
digitos_conforme_benford >= 7 & desviacion_promedio_benford < 0.2 ~ "Conforme con Benford ‚úì",
digitos_conforme_benford >= 5 & desviacion_promedio_benford < 0.3 ~ "Ligera desviaci√≥n ‚ö†Ô∏è",
digitos_conforme_benford >= 3 ~ "Desviaci√≥n moderada ‚ö†Ô∏è",
TRUE ~ "No conforme con Benford üö®"
),
.groups = 'drop'
)
# Gr√°fico para mostrar sesgos de manera visual
datos_sesgo <- tabla_media %>%
select(participante, `Sesgo_media`) %>%
left_join(
tabla_variabilidad %>% select(participante, `Sesgo (g/L)`),
by = "participante"
) %>%
pivot_longer(
cols = c(`Sesgo_media`, `Sesgo (g/L)`),
names_to = "tipo_sesgo",
values_to = "magnitud"
) %>%
mutate(
tipo_sesgo = case_when(
tipo_sesgo == "Sesgo_media" ~ "Sesgo Media",
tipo_sesgo == "Sesgo (g/L)" ~ "Sesgo Desviaci√≥n Est√°ndar"
),
direccion = ifelse(magnitud > 0, "Sobreestimaci√≥n", "Subestimaci√≥n")
)
g_sesgo <- ggplot(datos_sesgo, aes(x = participante, y = magnitud, fill = direccion)) +
geom_col(alpha = 0.8) +
geom_hline(yintercept = 0, linetype = "dashed", color = "black", size = 1) +
facet_wrap(~ tipo_sesgo, scales = "free_y") +
scale_fill_manual(values = c("Sobreestimaci√≥n" = "#EF8A62", "Subestimaci√≥n" = "#67A9CF")) +
labs(
title = "An√°lisis de Sesgo: Media vs Variabilidad",
subtitle = "Valores positivos = sobreestimaci√≥n | Valores negativos = subestimaci√≥n",
x = NULL,
y = "Magnitud del Sesgo (g/L)",
fill = "Direcci√≥n del Error"
) +
theme_minimal() +
theme(legend.position = "bottom")
veredicto_final <- tabla_media %>%
select(participante, Evaluaci√≥n_media = Evaluaci√≥n) %>%
left_join(
tabla_variabilidad %>%
mutate(Evaluaci√≥n_variabilidad = case_when(
`Error` == "‚¨áÔ∏è Muy baja" ~ "Subestimaci√≥n severa üö®",
`Error` == "‚¨ÜÔ∏è Muy alta" ~ "Sobreestimaci√≥n severa üö®",
`Error` == "‚¨áÔ∏è Baja" ~ "Subestimaci√≥n ‚ö†Ô∏è",
`Error` == "‚¨ÜÔ∏è Alta" ~ "Sobreestimaci√≥n ‚ö†Ô∏è"
)) %>%
select(participante, Evaluaci√≥n_variabilidad),
by = "participante"
) %>%
left_join(
resumen_ultimo_digito %>% select(participante, Evaluaci√≥n_digitos = evaluacion_digitos),
by = "participante"
) %>%
left_join(
analisis_rachas %>% select(participante, Evaluaci√≥n_rachas = evaluacion_rachas),
by = "participante"
) %>%
left_join(
analisis_benford %>% select(participante, Evaluaci√≥n_benford = evaluacion_benford),
by = "participante"
) %>%
mutate(
# Puntuaci√≥n basada en sesgo + intervalos de confianza
puntuacion_final = (
(str_detect(Evaluaci√≥n_media, "‚úì")) * 2 +
(str_detect(Evaluaci√≥n_media, "Muy buena")) * 1.5 +
(str_detect(Evaluaci√≥n_variabilidad, "‚ö†Ô∏è")) * 0.5 +
(!str_detect(Evaluaci√≥n_variabilidad, "üö®")) * 1 +
(str_detect(Evaluaci√≥n_digitos, "‚úì")) * 1.5 +
(str_detect(Evaluaci√≥n_digitos, "‚ö†Ô∏è")) * 1 +
(str_detect(Evaluaci√≥n_rachas, "‚úì")) * 1.5 +
(str_detect(Evaluaci√≥n_rachas, "‚ö†Ô∏è")) * 1 +
(str_detect(Evaluaci√≥n_benford, "‚úì")) * 1.5 +
(str_detect(Evaluaci√≥n_benford, "‚ö†Ô∏è")) * 1
),
evaluacion_final = case_when(
puntuacion_final >= 8 ~ "üåü Excelente coincidencia",
puntuacion_final >= 6 ~ "‚úÖ Buena aproximaci√≥n",
puntuacion_final >= 4 ~ "‚ö†Ô∏è Aproximaci√≥n moderada",
TRUE ~ "‚ùå Patrones artificiales detectados"
)
)
# bibliotecas (usa suppressMessages para silenciar mensajes de carga)
suppressMessages(library(tidyverse,verbose = F))
suppressMessages(library(knitr,verbose = F))
suppressMessages(library(kableExtra,verbose = F))  # C√°rgalo aqu√≠ o en setup
knitr::opts_chunk$set(
echo = FALSE,
fig.align = "center",
fig.height = 6,
fig.retina = 2,
fig.width = 10,
message = FALSE,
warning = FALSE,
cache = FALSE,
comment = "#>",
dpi = 300
)
source("analisis.R")
unlink("content/es/post/2025-10-20-pinocho/index_cache", recursive = TRUE)
# bibliotecas (usa suppressMessages para silenciar mensajes de carga)
suppressMessages(library(tidyverse,verbose = F))
suppressMessages(library(knitr,verbose = F))
suppressMessages(library(kableExtra,verbose = F))  # C√°rgalo aqu√≠ o en setup
knitr::opts_chunk$set(
echo = FALSE,
fig.align = "center",
fig.height = 6,
fig.retina = 2,
fig.width = 10,
message = FALSE,
warning = FALSE,
cache = FALSE,
comment = "#>",
dpi = 300
)
source("analisis.R")
blogdown::serve_site()
# bibliotecas (usa suppressMessages para silenciar mensajes de carga)
suppressMessages(library(tidyverse,verbose = F))
suppressMessages(library(knitr,verbose = F))
suppressMessages(library(kableExtra,verbose = F))  # C√°rgalo aqu√≠ o en setup
knitr::opts_chunk$set(
echo = FALSE,
fig.align = "center",
fig.height = 6,
fig.retina = 2,
fig.width = 10,
message = FALSE,
warning = FALSE,
cache = FALSE,
comment = "#>",
dpi = 300
)
source("analisis.R")
tabla_variabilidad <- datos %>%
filter(participante %in% c("La Prudente", "La Entusiasta", "La Confiada")) %>%
group_by(participante) %>%
summarise(
`Desviaci√≥n Est√°ndar Estimada (g/L)` = round(sd(valor), 1),
n = n(),
Media_grupo = round(mean(valor), 1),
Minimo = round(min(valor), 1),
Maximo = round(max(valor), 1),
.groups = 'drop'
) %>%
mutate(
`Desviaci√≥n Est√°ndar Poblacional (g/L)` = 7.5,
`Error Absoluto (g/L)` = round(`Desviaci√≥n Est√°ndar Estimada (g/L)` - 7.5, 1),
`Error Relativo (%)` = round((`Error Absoluto (g/L)` / 7.5) * 100, 1),
# CLASIFICACI√ìN BASADA EN LA DESVIACI√ìN EST√ÅNDAR POBLACIONAL
Calidad_Estimacion = case_when(
abs(`Error Absoluto (g/L)`) <= 0.75 ~ "‚úÖ Excelente",        # ‚â§10% de SD poblacional
abs(`Error Absoluto (g/L)`) <= 1.5  ~ "‚úÖ Adecuada",         # ‚â§20% de SD poblacional
abs(`Error Absoluto (g/L)`) <= 2.25 ~ "‚ö†Ô∏è Aceptable",        # ‚â§30% de SD poblacional
abs(`Error Absoluto (g/L)`) <= 3.0  ~ "‚¨ÜÔ∏è Alta",            # ‚â§40% de SD poblacional
abs(`Error Absoluto (g/L)`) > 3.0   ~ "‚¨ÜÔ∏è Muy alta",        # >40% de SD poblacional
TRUE ~ "Indeterminado"
),
# IMPACTO CL√çNICO ESPEC√çFICO PARA HEMOGLOBINA
Impacto_Clinico = case_when(
abs(`Error Absoluto (g/L)`) <= 0.75 ~ "Error m√≠nimo - sin impacto cl√≠nico",
abs(`Error Absoluto (g/L)`) <= 1.5  ~ "Variaci√≥n aceptable - screening confiable",
abs(`Error Absoluto (g/L)`) <= 2.25 ~ "Puede afectar clasificaci√≥n de casos l√≠mite",
abs(`Error Absoluto (g/L)`) <= 3.0  ~ "Compromete diagn√≥stico diferencial",
abs(`Error Absoluto (g/L)`) > 3.0   ~ "Error cr√≠tico - decisiones cl√≠nicas comprometidas",
TRUE ~ "No evaluable"
),
# INTERPRETACI√ìN EN CONTEXTO DEL RANGO NORMAL (121-151 g/L)
Interpretacion = paste(
"La variabilidad estimada representa",
round((`Desviaci√≥n Est√°ndar Estimada (g/L)` / 7.5 - 1) * 100, 0),
"% de la variabilidad poblacional real"
)
)
tabla_variabilidad
tabla_media %>% glimpse()
tabla_variabilidad %>% glimpse()
tabla_variabilidad %>% glimpse()
tabla_variabilidad %>%
select(-"n",-"Media_grupo",-"Desviaci√≥n Est√°ndar Poblacional (g/L)",-"Impacto_Clinico",-"Interpretacion" ) %>% names()
tabla_variabilidad %>%
select(-"n",-"Media_grupo",-"Desviaci√≥n Est√°ndar Poblacional (g/L)",-"Impacto_Clinico",-"Interpretacion" ) %>% names() %>% dput
analisis_ultimo_digito %>%
mutate(
valor = sprintf("%.1f%%", proporcion_observada * 100),
# Marcamos si se desv√≠a m√°s de 5 puntos porcentuales (muy alto o muy bajo)
valor = case_when(
proporcion_observada > 0.15 | proporcion_observada < 0.05 ~ paste0("**", valor, "**"),
TRUE ~ valor
)
) %>%
select(D√≠gito = ultimo_digito, participante, valor) %>%
pivot_wider(names_from = participante, values_from = valor) %>%
# mutate(Esperado = "10.0%", .after = D√≠gito) %>%
kable()
# bibliotecas (usa suppressMessages para silenciar mensajes de carga)
suppressMessages(library(tidyverse,verbose = F))
suppressMessages(library(knitr,verbose = F))
suppressMessages(library(kableExtra,verbose = F))  # C√°rgalo aqu√≠ o en setup
knitr::opts_chunk$set(
echo = FALSE,
fig.align = "center",
fig.height = 6,
fig.retina = 2,
fig.width = 10,
message = FALSE,
warning = FALSE,
cache = FALSE,
comment = "#>",
dpi = 300
)
source("analisis.R")
=================================================
pacman::p_load(tidyverse, knitr, kableExtra, scales)
# Cargar datos
# Aseg√∫rate de que "experimento.csv" est√° en la misma carpeta
if(file.exists("experimento.csv")) {
datos_completos <- read_csv("experimento.csv", show_col_types = FALSE)
} else {
stop("‚ö†Ô∏è No se encuentra el archivo 'experimento.csv'. Desc√°rgalo del blog.")
}
# Aseg√∫rate de que "experimento.csv" est√° en la misma carpeta
if(file.exists("experimento.csv")) {
datos_completos <- read_csv("experimento.csv", show_col_types = FALSE)
} else {
stop("‚ö†Ô∏è No se encuentra el archivo 'experimento.csv'. Desc√°rgalo del blog.")
}
# Cargar datos
datos <- read_csv("experimento.csv", show_col_types = FALSE)
# Cargar datos
datos <- read_delim("experimento.csv",delim = ",")
# Cargar datos
datos <- read_delim("experimento.csv", delim = ",")
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, knitr, kableExtra, scales)
# 1. CARGA DE DATOS
# -------------------------------------------------
if(file.exists("experimento.csv")) {
datos_completos <- read_csv("experimento.csv", show_col_types = FALSE)
} else {
stop("‚ö†Ô∏è No se encuentra 'experimento.csv'. Desc√°rgalo del blog.")
}
datos <- datos_completos %>% filter(participante != "REALIDAD")
datos_realidad <- datos_completos %>% filter(participante == "REALIDAD")
# 1. CARGA DE DATOS
# -------------------------------------------------
if(file.exists("experimento.csv")) {
datos_completos <- read_csv("experimento.csv", show_col_types = FALSE)
} else {
stop("‚ö†Ô∏è No se encuentra 'experimento.csv'. Desc√°rgalo del blog.")
}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, knitr, kableExtra, scales)
# 1. CARGA Y CONFIGURACI√ìN
# -------------------------------------------------
if(file.exists("experimento.csv")) {
datos_completos <- read_csv("experimento.csv", show_col_types = FALSE)
} else {
stop("Error: Archivo 'experimento.csv' no encontrado.")
}
# Filtramos "REALIDAD" porque usaremos par√°metros fijos de literatura
datos <- datos_completos %>% filter(participante != "REALIDAD")
# PAR√ÅMETROS FIJOS DE LITERATURA (Harrison / Medicina Interna)
media_real <- 136.0  # g/L
sd_real    <- 7.5    # g/L
# TEMA GR√ÅFICO SOBRIO
theme_academico <- function() {
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold", color = "black"),
strip.background = element_rect(fill = "gray80", color = NA),
strip.text = element_text(color = "black", face = "bold"),
legend.position = "bottom",
panel.grid.minor = element_blank()
)
}
# 2. AN√ÅLISIS DE MEDIA (SESGO)
# -------------------------------------------------
tabla_media <- datos %>%
group_by(participante) %>%
summarise(
n = n(),
Media = mean(valor),
.groups = 'drop'
) %>%
mutate(
Ref_Media = media_real,
Diferencia = Media - media_real,
Evaluacion = case_when(
abs(Diferencia) > 10 ~ "Sesgo Muy Alto",
abs(Diferencia) > 5  ~ "Sesgo Moderado",
TRUE                 ~ "Adecuado"
)
)
# Tabla formateada para index.Rmd (evita errores de col.names)
tabla_media_display <- tabla_media %>%
select(Participante = participante,
N = n,
`Media (g/L)` = Media,
`Ref. Lit.` = Ref_Media,
`Dif.` = Diferencia,
`Evaluaci√≥n` = Evaluacion)
# 3. AN√ÅLISIS DE VARIABILIDAD
# -------------------------------------------------
tabla_variabilidad <- datos %>%
group_by(participante) %>%
summarise(SD = sd(valor)) %>%
mutate(
Ref_SD = sd_real,
Dif_SD = abs(SD - sd_real),
Evaluacion = case_when(
Dif_SD < 2.5 ~ "Excelente",
Dif_SD < 5.0 ~ "Aceptable",
TRUE         ~ "Deficiente"
)
)
# Tabla formateada para index.Rmd
tabla_variabilidad_display <- tabla_variabilidad %>%
select(Participante = participante,
`SD (g/L)` = SD,
`Ref. SD` = Ref_SD,
`Evaluaci√≥n` = Evaluacion)
# =================================================
# SCRIPT: AN√ÅLISIS FORENSE DE DATOS
# Versi√≥n: Acad√©mica (Sin emojis, par√°metros fijos)
# =================================================
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, knitr, kableExtra, scales)
# 1. CARGA Y CONFIGURACI√ìN
# -------------------------------------------------
if(file.exists("experimento.csv")) {
datos_completos <- read_csv("experimento.csv", show_col_types = FALSE)
} else {
stop("Error: Archivo 'experimento.csv' no encontrado.")
}
library(readr)
experimento <- read_csv("content/es/post/2025-10-20-pinocho/experimento.csv")
View(experimento)
# Filtramos "REALIDAD" porque usaremos par√°metros fijos de literatura
datos <- datos_completos %>% filter(participante != "REALIDAD")
datos_completos <- read_csv("experimento.csv", show_col_types = FALSE)
install.packages("forensicstats")
install.packages("benford.analysis")
install.packages("randtests")
install.packages("recheck")
install.packages("digitTests")
install.packages("statcheck")
install.packages("snoop")
blogdown::serve_site()
# bibliotecas (usa suppressMessages para silenciar mensajes de carga)
suppressMessages(library(tidyverse,verbose = F))
suppressMessages(library(knitr,verbose = F))
suppressMessages(library(kableExtra,verbose = F))  # C√°rgalo aqu√≠ o en setup
knitr::opts_chunk$set(
echo = FALSE,
fig.align = "center",
fig.height = 6,
fig.retina = 2,
fig.width = 10,
message = FALSE,
warning = FALSE,
cache = FALSE,
comment = "#>",
dpi = 300
)
source("analisis.R")
tabla_media %>%
kable(col.names = c("Participante","Valores inventados","Media aritm√©tica", "Error de estimaci√≥n", "Resultado"))
tabla_media %>% glimpse()
tabla_media %>%
kable()
tabla_variabilidad %>%
select(-"n",-"Media_grupo",-"Desviaci√≥n Est√°ndar Poblacional (g/L)",-"Impacto_Clinico",-"Interpretacion" ) %>%
kable(col.names = c("Participante", "Desviaci√≥n Est√°ndar", "Minimo",
"Maximo", "Error Absoluto", "Error Relativo (%)", "Resultado"
))
tabla_variabilidad %>% glimpse()
tabla_variabilidad %>%
kable()
analisis_ultimo_digito %>%
mutate(
valor = sprintf("%.1f%%", proporcion_observada * 100),
# Marcamos si se desv√≠a m√°s de 5 puntos porcentuales (muy alto o muy bajo)
valor = case_when(
proporcion_observada > 0.15 | proporcion_observada < 0.05 ~ paste0("**", valor, "**"),
TRUE ~ valor
)
) %>%
select(D√≠gito = ultimo_digito, participante, valor) %>%
pivot_wider(names_from = participante, values_from = valor) %>%
# mutate(Esperado = "10.0%", .after = D√≠gito) %>%
kable()
analisis_ultimo_digito %>% glimpse()
analisis_ultimo_digito %>%
# mutate(
#   valor = sprintf("%.1f%%", proporcion_observada * 100),
#   # Marcamos si se desv√≠a m√°s de 5 puntos porcentuales (muy alto o muy bajo)
#   valor = case_when(
#     proporcion_observada > 0.15 | proporcion_observada < 0.05 ~ paste0("**", valor, "**"),
#     TRUE ~ valor
#   )
# ) %>%
# select(D√≠gito = ultimo_digito, participante, valor) %>%
# pivot_wider(names_from = participante, values_from = valor) %>%
# # mutate(Esperado = "10.0%", .after = D√≠gito) %>%
kable()
tabla_desviacion %>%
select(Participante = participante, `Desviaci√≥n Promedio`, `Peor Error`) %>%
kable()
tabla_desviacion %>%
# select(Participante = participante, `Desviaci√≥n Promedio`, `Peor Error`) %>%
kable()
analisis_rachas %>% glimpse()
analisis_benford %>% glimpse()
library(digitTests)
install.packages("analisis_benford")
install.packages("snoop")
install.packages("scrutiny")
library(scrutiny)
install.packages("TSP")
install.packages(c("foreach", "doParallel", "gclus", "seriation"))
install.packages("TSP", type = "binary")
library(TSP)
detach("package:TSP", unload = TRUE)
library(tidyverse)
library(conflicted)
library(digitTests)
library(benford.analysis)
library(randtests)
library(scrutiny)
install.packages("statcheck")
datos_completos <- readr::read_delim(file = "experimento.csv",delim = ",")
# bibliotecas (usa suppressMessages para silenciar mensajes de carga)
suppressMessages(library(tidyverse,verbose = F))
suppressMessages(library(knitr,verbose = F))
suppressMessages(library(kableExtra,verbose = F))  # C√°rgalo aqu√≠ o en setup
knitr::opts_chunk$set(
echo = FALSE,
fig.align = "center",
fig.height = 6,
fig.retina = 2,
fig.width = 10,
message = FALSE,
warning = FALSE,
cache = FALSE,
comment = "#>",
dpi = 300
)
source("analisis.R")
source("analisis.R")
datos_completos <- readr::read_delim(file = "experimento.csv",delim = ",")
# SCRIPT: AN√ÅLISIS FORENSE DE DATOS
# Autor: Maicel Monzon MD, PHd
# Fecha: 02/12/2025
# bibliotecas
suppressMessages(library(tidyverse,verbose = F))
library(conflicted)
conflicts_prefer(stats::filter)
library(digitTests)
library(benford.analysis)
library(randtests)
library(scrutiny)
library(statcheck)
library(scales)
datos_completos <- readr::read_delim(file = "experimento.csv",delim = ",")
# 1. CARGA Y CONFIGURACI√ìN-------------------------------------------------
library(readr)
datos_completos <- readr::read_delim(file = "experimento.csv",delim = ",")
datos_completos <- read_csv("content/es/post/2025-10-20-pinocho/experimento.csv")
library(dlookr)
install.packages("dlookr")
suppressMessages(library(tidyverse,verbose = F))
library(conflicted)
conflicts_prefer(stats::filter)
library(digitTests)
library(benford.analysis)
library(randtests)
library(scrutiny)
library(statcheck)
library(scales)
library(dlookr)
# 1. CARGA Y CONFIGURACI√ìN-------------------------------------------------
library(readr)
datos_completos <- readr::read_delim(file = "experimento.csv",delim = ",")
