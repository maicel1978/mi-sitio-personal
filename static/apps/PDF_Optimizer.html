<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Forge Pro ‚Äî Optimizador con OCR</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

    <style>
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --bg-tertiary: #1a2235;
            --bg-elevated: #1e293b;
            --accent-blue: #3b82f6;
            --accent-blue-soft: rgba(59,130,246,0.15);
            --accent-violet: #8b5cf6;
            --accent-violet-soft: rgba(139,92,246,0.15);
            --accent-emerald: #10b981;
            --accent-emerald-soft: rgba(16,185,129,0.12);
            --accent-amber: #f59e0b;
            --accent-red: #ef4444;
            --accent-red-soft: rgba(239,68,68,0.12);
            --accent-cyan: #06b6d4;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --text-faint: #475569;
            --border-subtle: rgba(148,163,184,0.08);
            --border-medium: rgba(148,163,184,0.15);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-2xl: 24px;
            --radius-full: 9999px;
            --ease-out: cubic-bezier(0.16,1,0.3,1);
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter','SF Pro Display',-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 20px 16px 40px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse 80% 60% at 50% -20%, rgba(59,130,246,0.08), transparent),
                radial-gradient(ellipse 60% 40% at 80% 100%, rgba(139,92,246,0.06), transparent);
            pointer-events: none;
            z-index: 0;
        }

        .app-container {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 580px;
        }

        .app-header {
            text-align: center;
            margin-bottom: 28px;
            padding-top: 10px;
        }

        .app-logo {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .logo-icon {
            width: 44px; height: 44px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-violet));
            border-radius: var(--radius-md);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem;
            box-shadow: 0 4px 15px rgba(59,130,246,0.3);
        }

        .logo-text { text-align: left; }

        .logo-text h1 {
            font-size: 1.35rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .logo-text .version-tag {
            font-size: 0.65rem;
            color: var(--text-muted);
            font-weight: 500;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .app-subtitle { font-size: 0.8rem; color: var(--text-muted); margin-top: 6px; }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-2xl);
            box-shadow: 0 25px 60px -12px rgba(0,0,0,0.6);
            overflow: hidden;
        }

        .card-body { padding: 24px; }

        /* Upload Zone */
        .upload-zone {
            position: relative;
            border: 2px dashed var(--border-medium);
            border-radius: var(--radius-xl);
            padding: 40px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 300ms var(--ease-out);
            background: var(--bg-primary);
            margin-bottom: 24px;
            overflow: hidden;
        }

        .upload-zone::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, var(--accent-blue-soft), transparent 70%);
            opacity: 0;
            transition: opacity 300ms;
        }

        .upload-zone:hover { border-color: var(--accent-blue); transform: translateY(-2px); }
        .upload-zone:hover::before { opacity: 1; }

        .upload-zone.drag-over {
            border-color: var(--accent-violet);
            background: var(--accent-violet-soft);
            transform: scale(1.02);
        }

        .upload-zone.has-file {
            border-color: var(--accent-emerald);
            border-style: solid;
            background: var(--accent-emerald-soft);
            padding: 20px 24px;
        }

        .upload-content { position: relative; z-index: 1; }

        .upload-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            display: block;
            filter: grayscale(0.3);
            transition: filter 300ms;
        }

        .upload-zone:hover .upload-icon { filter: grayscale(0); }
        .upload-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 6px; }
        .upload-hint { font-size: 0.75rem; color: var(--text-muted); }

        .file-info {
            display: none;
            align-items: center;
            gap: 14px;
            text-align: left;
        }

        .has-file .default-content { display: none; }
        .has-file .file-info { display: flex; }

        .file-icon-wrapper {
            width: 48px; height: 48px;
            border-radius: var(--radius-md);
            background: var(--accent-emerald-soft);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .file-details { flex: 1; min-width: 0; }

        .file-name {
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-meta { font-size: 0.72rem; color: var(--text-muted); margin-top: 2px; }

        .file-remove {
            width: 32px; height: 32px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-medium);
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 1rem;
            transition: all 150ms;
            flex-shrink: 0;
        }

        .file-remove:hover {
            background: var(--accent-red-soft);
            border-color: var(--accent-red);
            color: var(--accent-red);
        }

        /* Section titles */
        .section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.2px;
            margin-bottom: 14px;
        }

        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-subtle);
        }

        /* Settings */
        .settings-panel {
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            padding: 20px;
            margin-bottom: 24px;
        }

        .setting-group { margin-bottom: 20px; }
        .setting-group:last-child { margin-bottom: 0; }

        .setting-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .setting-label-text { font-size: 0.8rem; font-weight: 600; }

        .setting-label-value {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--accent-blue);
            background: var(--accent-blue-soft);
            padding: 2px 10px;
            border-radius: var(--radius-full);
        }

        .custom-select { position: relative; }

        .custom-select select {
            width: 100%;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            border: 1px solid var(--border-medium);
            color: var(--text-primary);
            font-size: 0.82rem;
            font-weight: 500;
            cursor: pointer;
            appearance: none;
            transition: border-color 150ms;
            outline: none;
        }

        .custom-select select:hover,
        .custom-select select:focus {
            border-color: var(--accent-blue);
        }

        .custom-select select:focus {
            box-shadow: 0 0 0 3px var(--accent-blue-soft);
        }

        .custom-select::after {
            content: '‚ñæ';
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 0.8rem;
            pointer-events: none;
        }

        .range-slider input[type="range"] {
            width: 100%;
            height: 6px;
            appearance: none;
            background: var(--bg-elevated);
            border-radius: var(--radius-full);
            outline: none;
            cursor: pointer;
        }

        .range-slider input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 22px; height: 22px;
            border-radius: 50%;
            background: var(--accent-blue);
            border: 3px solid var(--bg-primary);
            box-shadow: 0 2px 8px rgba(59,130,246,0.4);
            cursor: pointer;
            transition: transform 150ms;
        }

        .range-slider input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.15); }

        .range-slider input[type="range"]::-moz-range-thumb {
            width: 22px; height: 22px;
            border-radius: 50%;
            background: var(--accent-blue);
            border: 3px solid var(--bg-primary);
            box-shadow: 0 2px 8px rgba(59,130,246,0.4);
            cursor: pointer;
        }

        .range-marks {
            display: flex;
            justify-content: space-between;
            padding: 6px 4px 0;
        }

        .range-marks span { font-size: 0.6rem; color: var(--text-faint); }

        /* OCR */
        .ocr-panel {
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            padding: 20px;
            margin-bottom: 24px;
            transition: border-color 300ms, box-shadow 300ms;
        }

        .ocr-panel.active {
            border-color: rgba(139,92,246,0.3);
            box-shadow: 0 0 40px rgba(139,92,246,0.15);
        }

        .toggle-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toggle-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toggle-icon {
            width: 40px; height: 40px;
            border-radius: var(--radius-md);
            background: var(--accent-violet-soft);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem;
            transition: all 300ms;
        }

        .ocr-panel.active .toggle-icon {
            background: linear-gradient(135deg, var(--accent-violet), var(--accent-blue));
            box-shadow: 0 4px 12px rgba(139,92,246,0.3);
        }

        .toggle-text h3 { font-size: 0.85rem; font-weight: 600; margin-bottom: 2px; }
        .toggle-text p { font-size: 0.7rem; color: var(--text-muted); }

        .switch {
            position: relative;
            width: 52px;
            height: 28px;
            flex-shrink: 0;
        }

        .switch input { opacity: 0; width: 0; height: 0; position: absolute; }

        .switch-track {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--bg-elevated);
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-full);
            transition: all 300ms var(--ease-out);
        }

        .switch-track::before {
            content: '';
            position: absolute;
            height: 20px; width: 20px;
            left: 3px; bottom: 3px;
            background: var(--text-muted);
            border-radius: 50%;
            transition: all 300ms var(--ease-out);
        }

        .switch input:checked + .switch-track {
            background: var(--accent-violet);
            border-color: var(--accent-violet);
        }

        .switch input:checked + .switch-track::before {
            transform: translateX(24px);
            background: white;
        }

        .ocr-expanded {
            max-height: 0;
            overflow: hidden;
            transition: max-height 500ms var(--ease-out), opacity 300ms, margin 300ms;
            opacity: 0;
            margin-top: 0;
        }

        .ocr-expanded.active {
            max-height: 300px;
            opacity: 1;
            margin-top: 18px;
        }

        .ocr-benefits {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .ocr-benefit {
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            padding: 10px 8px;
            text-align: center;
            font-size: 0.65rem;
            color: var(--text-secondary);
        }

        .ocr-benefit-icon { font-size: 1.1rem; display: block; margin-bottom: 4px; }

        /* Progress */
        .progress-section {
            margin-bottom: 24px;
            display: none;
        }

        .progress-section.active {
            display: block;
            animation: slideDown 300ms var(--ease-out);
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .progress-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            padding: 20px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .progress-status { font-size: 0.78rem; font-weight: 600; }
        .progress-percent {
            font-size: 0.85rem;
            font-weight: 800;
            color: var(--accent-blue);
            font-variant-numeric: tabular-nums;
        }

        .progress-detail {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 14px;
            min-height: 1.2em;
        }

        .progress-track {
            width: 100%;
            height: 6px;
            background: var(--bg-elevated);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .progress-fill {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan));
            border-radius: var(--radius-full);
            transition: width 200ms var(--ease-out);
        }

        .progress-fill.ocr-mode {
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-violet));
        }

        .progress-fill.error { background: var(--accent-red); }
        .progress-fill.complete {
            background: linear-gradient(90deg, var(--accent-emerald), var(--accent-cyan));
        }

        /* Stats */
        .stats-grid {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .stats-grid.active { display: grid; }

        .stat-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 16px;
            text-align: center;
        }

        .stat-card.result { border-color: rgba(16,185,129,0.2); }

        .stat-label {
            font-size: 0.6rem;
            font-weight: 700;
            color: var(--text-faint);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 800;
            font-variant-numeric: tabular-nums;
        }

        .stat-card.result .stat-value { color: var(--accent-emerald); }

        .savings-badge {
            display: none;
            margin-top: 8px;
            font-size: 0.65rem;
            font-weight: 800;
            padding: 3px 10px;
            border-radius: var(--radius-full);
        }

        .savings-badge.positive {
            background: var(--accent-emerald-soft);
            color: var(--accent-emerald);
            display: inline-block;
        }

        .savings-badge.negative {
            background: var(--accent-red-soft);
            color: var(--accent-red);
            display: inline-block;
        }

        /* Error */
        .error-banner {
            display: none;
            background: var(--accent-red-soft);
            border: 1px solid rgba(239,68,68,0.3);
            border-radius: var(--radius-md);
            padding: 14px 16px;
            margin-bottom: 20px;
            font-size: 0.78rem;
            color: #fca5a5;
            line-height: 1.5;
            align-items: flex-start;
            gap: 10px;
            animation: shake 0.4s ease;
        }

        .error-banner.active { display: flex; }
        .error-icon { flex-shrink: 0; font-size: 1.1rem; }

        @keyframes shake {
            0%,100% { transform: translateX(0); }
            20% { transform: translateX(-6px); }
            40% { transform: translateX(6px); }
            60% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 16px 24px;
            border: none;
            border-radius: var(--radius-lg);
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 300ms var(--ease-out);
            outline: none;
            position: relative;
            overflow: hidden;
        }

        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue), #2563eb);
            color: white;
            box-shadow: 0 4px 20px rgba(59,130,246,0.3);
            letter-spacing: 0.5px;
        }

        .btn-primary:hover:not(:disabled) {
            box-shadow: 0 6px 30px rgba(59,130,246,0.45);
            transform: translateY(-1px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--accent-emerald), #059669);
            color: white;
            box-shadow: 0 4px 20px rgba(16,185,129,0.3);
            margin-top: 12px;
            display: none;
        }

        .btn-success.active {
            display: flex;
            animation: slideDown 300ms var(--ease-out);
        }

        .btn-success:hover:not(:disabled) {
            box-shadow: 0 6px 30px rgba(16,185,129,0.45);
            transform: translateY(-1px);
        }

        .btn-icon { font-size: 1.15rem; }

        .spinner {
            display: none;
            width: 18px; height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .btn-primary.processing .spinner { display: block; }
        .btn-primary.processing .btn-label { display: none; }

        @keyframes spin { to { transform: rotate(360deg); } }

        .app-footer {
            text-align: center;
            padding: 20px 24px;
            border-top: 1px solid var(--border-subtle);
            background: rgba(0,0,0,0.2);
        }

        .footer-text { font-size: 0.65rem; color: var(--text-faint); line-height: 1.6; }

        .hidden-canvas {
            position: absolute;
            left: -9999px; top: -9999px;
            visibility: hidden;
        }

        @media (max-width: 420px) {
            .card-body { padding: 18px; }
            .settings-panel, .ocr-panel, .progress-card { padding: 16px; }
            .upload-zone { padding: 28px 16px; }
            .ocr-benefits { grid-template-columns: 1fr; }
            .logo-text h1 { font-size: 1.15rem; }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>

<div class="app-container">
    <header class="app-header">
        <div class="app-logo">
            <div class="logo-icon">‚ö°</div>
            <div class="logo-text">
                <h1>PDF Forge Pro</h1>
                <span class="version-tag">Motor de Compresi√≥n v2.0 + OCR</span>
            </div>
        </div>
        <p class="app-subtitle">Comprime, optimiza y haz buscables tus PDFs ‚Äî todo en el navegador</p>
    </header>

    <div class="card">
        <div class="card-body">

            <div class="upload-zone" id="uploadZone" role="button" tabindex="0">
                <div class="upload-content default-content">
                    <span class="upload-icon">üìÑ</span>
                    <div class="upload-title">Arrastra tu PDF aqu√≠</div>
                    <div class="upload-hint">o haz clic para seleccionar ¬∑ M√°x. 200 MB</div>
                </div>
                <div class="file-info">
                    <div class="file-icon-wrapper">üìã</div>
                    <div class="file-details">
                        <div class="file-name" id="fileName">‚Äî</div>
                        <div class="file-meta" id="fileMeta">‚Äî</div>
                    </div>
                    <button class="file-remove" id="fileRemove" title="Quitar archivo">‚úï</button>
                </div>
                <input type="file" id="fileInput" accept="application/pdf" style="display:none">
            </div>

            <div class="section-title">‚öôÔ∏è Configuraci√≥n</div>
            <div class="settings-panel">
                <div class="setting-group">
                    <div class="setting-label">
                        <span class="setting-label-text">Perfil de compresi√≥n</span>
                    </div>
                    <div class="custom-select">
                        <select id="resProfile">
                            <option value="0.7">üî• Compresi√≥n m√°xima</option>
                            <option value="1.2" selected>‚öñÔ∏è Equilibrado (Recomendado)</option>
                            <option value="1.8">üî¨ Alta fidelidad</option>
                            <option value="2.4">üíé Ultra calidad</option>
                        </select>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-label">
                        <span class="setting-label-text">Calidad visual</span>
                        <span class="setting-label-value" id="qLabel">60%</span>
                    </div>
                    <div class="range-slider">
                        <input type="range" id="quality" min="10" max="95" value="60">
                        <div class="range-marks"><span>M√≠n</span><span>M√°x</span></div>
                    </div>
                </div>
            </div>

            <div class="section-title">üî§ Reconocimiento de Texto</div>
            <div class="ocr-panel" id="ocrPanel">
                <div class="toggle-row">
                    <div class="toggle-info">
                        <div class="toggle-icon">üîç</div>
                        <div class="toggle-text">
                            <h3>Texto seleccionable (OCR)</h3>
                            <p>Permite copiar, pegar y buscar</p>
                        </div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="ocrToggle">
                        <span class="switch-track"></span>
                    </label>
                </div>

                <div class="ocr-expanded" id="ocrExpanded">
                    <div class="ocr-benefits">
                        <div class="ocr-benefit"><span class="ocr-benefit-icon">üìã</span>Copiar texto</div>
                        <div class="ocr-benefit"><span class="ocr-benefit-icon">üîé</span>Buscar (Ctrl+F)</div>
                        <div class="ocr-benefit"><span class="ocr-benefit-icon">‚ôø</span>Accesibilidad</div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-label">
                            <span class="setting-label-text">Idioma del documento</span>
                        </div>
                        <div class="custom-select">
                            <select id="ocrLang">
                                <option value="spa" selected>üá™üá∏ Espa√±ol</option>
                                <option value="eng">üá¨üáß English</option>
                                <option value="por">üáßüá∑ Portugu√™s</option>
                                <option value="fra">üá´üá∑ Fran√ßais</option>
                                <option value="ita">üáÆüáπ Italiano</option>
                                <option value="deu">üá©üá™ Deutsch</option>
                                <option value="spa+eng">üåê Espa√±ol + English</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-label">Original</div>
                    <div class="stat-value" id="origSize">‚Äî</div>
                </div>
                <div class="stat-card result">
                    <div class="stat-label">Optimizado</div>
                    <div class="stat-value" id="newSize">‚Äî</div>
                    <span class="savings-badge" id="savingsBadge"></span>
                </div>
            </div>

            <div class="error-banner" id="errorBanner" role="alert">
                <span class="error-icon">‚ö†Ô∏è</span>
                <span id="errorText"></span>
            </div>

            <div class="progress-section" id="progressSection">
                <div class="progress-card">
                    <div class="progress-header">
                        <span class="progress-status" id="progressStatus">Preparando...</span>
                        <span class="progress-percent" id="progressPercent">0%</span>
                    </div>
                    <div class="progress-detail" id="progressDetail"></div>
                    <div class="progress-track">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" id="processBtn" disabled>
                <span class="spinner"></span>
                <span class="btn-label">
                    <span class="btn-icon">‚ö°</span>
                    Optimizar PDF
                </span>
            </button>

            <button class="btn btn-success" id="downloadBtn">
                <span class="btn-icon">üì•</span>
                Descargar PDF Optimizado
            </button>
        </div>

        <footer class="app-footer">
            <div class="footer-text">
                Procesamiento 100% local ‚Äî Tu archivo nunca sale de tu dispositivo<br>
                PDF Forge Pro ¬∑ Maicel Monz√≥n-P√©rez ¬∑ ¬© 2024
            </div>
        </footer>
    </div>
</div>

<canvas id="renderCanvas" class="hidden-canvas"></canvas>

<script>
(() => {
    'use strict';

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CONFIGURACI√ìN
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    const CONFIG = {
        MAX_FILE_SIZE: 200 * 1024 * 1024,
        MAX_CANVAS_DIM: 4096,
        YIELD_DELAY: 30,
        OCR_MIN_CONFIDENCE: 30,
        PDFJS_WORKER: 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js'
    };

    // PDF.js init
    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = CONFIG.PDFJS_WORKER;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ELEMENTOS DOM
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    const $ = (id) => document.getElementById(id);

    const DOM = {
        fileInput: $('fileInput'),
        uploadZone: $('uploadZone'),
        fileName: $('fileName'),
        fileMeta: $('fileMeta'),
        fileRemove: $('fileRemove'),
        resProfile: $('resProfile'),
        quality: $('quality'),
        qLabel: $('qLabel'),
        ocrToggle: $('ocrToggle'),
        ocrPanel: $('ocrPanel'),
        ocrExpanded: $('ocrExpanded'),
        ocrLang: $('ocrLang'),
        statsGrid: $('statsGrid'),
        origSize: $('origSize'),
        newSize: $('newSize'),
        savingsBadge: $('savingsBadge'),
        errorBanner: $('errorBanner'),
        errorText: $('errorText'),
        progressSection: $('progressSection'),
        progressStatus: $('progressStatus'),
        progressPercent: $('progressPercent'),
        progressDetail: $('progressDetail'),
        progressFill: $('progressFill'),
        processBtn: $('processBtn'),
        downloadBtn: $('downloadBtn'),
        canvas: $('renderCanvas')
    };

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ESTADO
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    let selectedFile = null;
    let finalBlob = null;
    let blobUrl = null;
    let tesseractWorker = null;
    let isProcessing = false;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  UTILIDADES
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function formatSize(bytes) {
        if (!bytes || bytes === 0) return '0 B';
        const units = ['B', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(1024));
        const val = bytes / Math.pow(1024, i);
        return val.toFixed(i >= 2 ? 2 : (i >= 1 ? 1 : 0)) + ' ' + units[i];
    }

    function wait(ms) {
        return new Promise(r => setTimeout(r, ms || CONFIG.YIELD_DELAY));
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  INTERFAZ
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function showError(msg) {
        DOM.errorText.textContent = msg;
        DOM.errorBanner.classList.add('active');
    }

    function hideError() {
        DOM.errorBanner.classList.remove('active');
    }

    function setProgress(percent, status, detail) {
        if (percent !== null && percent !== undefined) {
            DOM.progressFill.style.width = Math.round(percent) + '%';
            DOM.progressPercent.textContent = Math.round(percent) + '%';
        }
        if (status !== null && status !== undefined) {
            DOM.progressStatus.textContent = status;
        }
        if (detail !== null && detail !== undefined) {
            DOM.progressDetail.textContent = detail;
        }
    }

    function resetAll() {
        DOM.progressFill.style.width = '0%';
        DOM.progressFill.className = 'progress-fill';
        DOM.progressPercent.textContent = '0%';
        DOM.progressStatus.textContent = 'Preparando...';
        DOM.progressDetail.textContent = '';
        DOM.newSize.textContent = '‚Äî';
        DOM.savingsBadge.className = 'savings-badge';
        DOM.savingsBadge.textContent = '';
        DOM.downloadBtn.classList.remove('active');
        DOM.progressSection.classList.remove('active');
        hideError();

        if (blobUrl) {
            URL.revokeObjectURL(blobUrl);
            blobUrl = null;
        }
        finalBlob = null;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ARCHIVOS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function validateFile(file) {
        if (!file) return 'No se seleccion√≥ ning√∫n archivo.';
        if (file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')) {
            return 'El archivo no es un PDF v√°lido.';
        }
        if (file.size > CONFIG.MAX_FILE_SIZE) {
            return 'El archivo excede el l√≠mite de ' + formatSize(CONFIG.MAX_FILE_SIZE) + '.';
        }
        if (file.size === 0) return 'El archivo est√° vac√≠o.';
        return null;
    }

    function loadFile(file) {
        hideError();
        resetAll();

        const err = validateFile(file);
        if (err) { showError(err); return; }

        selectedFile = file;
        DOM.uploadZone.classList.add('has-file');
        DOM.fileName.textContent = file.name;
        DOM.fileMeta.textContent = formatSize(file.size) + ' ¬∑ PDF';
        DOM.origSize.textContent = formatSize(file.size);
        DOM.statsGrid.classList.add('active');
        DOM.processBtn.disabled = false;
    }

    function clearFile() {
        DOM.uploadZone.classList.remove('has-file');
        DOM.fileName.textContent = '‚Äî';
        DOM.fileMeta.textContent = '‚Äî';
        DOM.fileInput.value = '';
        DOM.origSize.textContent = '‚Äî';
        DOM.statsGrid.classList.remove('active');
        DOM.processBtn.disabled = true;
        selectedFile = null;
        resetAll();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  OCR (Tesseract.js v5)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    const OCR_LABELS = {
        'loading tesseract core':       '‚öôÔ∏è Cargando motor OCR...',
        'initializing tesseract':       '‚öôÔ∏è Inicializando OCR...',
        'loading language traineddata': 'üì¶ Descargando modelo de idioma...',
        'loaded language traineddata':  '‚úì Modelo cargado',
        'initializing api':            '‚öôÔ∏è Preparando reconocimiento...',
        'recognizing text':            'üîç Reconociendo texto...'
    };

    async function initOCR(lang) {
        DOM.progressDetail.textContent = '‚öôÔ∏è Inicializando motor OCR...';
        tesseractWorker = await Tesseract.createWorker(lang, 1, {
            logger: (m) => {
                if (m.status === 'recognizing text') {
                    DOM.progressDetail.textContent = 'üîç OCR: ' + Math.round(m.progress * 100) + '%';
                } else {
                    DOM.progressDetail.textContent = OCR_LABELS[m.status] || m.status;
                }
            }
        });
    }

    async function runOCR(canvas) {
        try {
            const result = await tesseractWorker.recognize(canvas);
            return result.data;
        } catch (e) {
            console.warn('OCR error:', e);
            return null;
        }
    }

    async function stopOCR() {
        if (tesseractWorker) {
            try { await tesseractWorker.terminate(); } catch(e) {}
            tesseractWorker = null;
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CAPA DE TEXTO INVISIBLE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function addTextLayer(pdf, ocrData, pageW, pageH, canvasW, canvasH) {
        if (!ocrData || !ocrData.words || ocrData.words.length === 0) return;

        const sx = pageW / canvasW;
        const sy = pageH / canvasH;

        pdf.saveGraphicsState();
        try {
            const gs = new pdf.GState({ opacity: 0.01 });
            pdf.setGState(gs);
        } catch(e) {
            // Fallback si GState no funciona
        }
        pdf.setFont('Helvetica');
        pdf.setTextColor(0, 0, 0);

        let added = 0;
        for (const word of ocrData.words) {
            if (word.confidence < CONFIG.OCR_MIN_CONFIDENCE) continue;
            const txt = (word.text || '').trim();
            if (!txt) continue;

            const x = word.bbox.x0 * sx;
            const y = word.bbox.y0 * sy;
            const h = (word.bbox.y1 - word.bbox.y0) * sy;
            const fontSize = Math.max(2, h * 0.72);

            pdf.setFontSize(fontSize);

            try {
                pdf.text(txt, x, y + h * 0.82);
                added++;
            } catch {
                try {
                    const safe = txt.replace(/[^\x20-\x7E\xA0-\xFF]/g, '');
                    if (safe) { pdf.text(safe, x, y + h * 0.82); added++; }
                } catch { /* skip */ }
            }
        }

        pdf.restoreGraphicsState();
        return added;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  PROCESAMIENTO PRINCIPAL
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    async function processDocument() {
        if (!selectedFile || isProcessing) return;

        isProcessing = true;
        DOM.processBtn.disabled = true;
        DOM.processBtn.classList.add('processing');
        resetAll();
        DOM.progressSection.classList.add('active');

        const quality = DOM.quality.value / 100;
        const scale = parseFloat(DOM.resProfile.value);
        const enableOCR = DOM.ocrToggle.checked;
        const ocrLang = DOM.ocrLang.value;

        if (enableOCR) {
            DOM.progressFill.classList.add('ocr-mode');
        }

        let pdfDoc = null;
        let outPdf = null;

        try {
            // 1. OCR Init
            if (enableOCR) {
                setProgress(2, 'Inicializando OCR...', '');
                await initOCR(ocrLang);
            }

            // 2. Cargar PDF
            setProgress(5, 'Cargando documento...', '');
            const arrayBuffer = await selectedFile.arrayBuffer();
            const data = new Uint8Array(arrayBuffer);

            pdfDoc = await pdfjsLib.getDocument({ data: data }).promise;
            const totalPages = pdfDoc.numPages;
            setProgress(8, 'Documento cargado', totalPages + ' p√°ginas detectadas');

            const { jsPDF } = window.jspdf;

            const canvas = DOM.canvas;
            const ctx = canvas.getContext('2d', { alpha: false, willReadFrequently: true });

            // 3. Procesar cada p√°gina
            for (let i = 1; i <= totalPages; i++) {

                const pctBase = 10 + ((i - 1) / totalPages) * 80;
                const pctEnd  = 10 + (i / totalPages) * 80;

                // 3a. Renderizar
                setProgress(pctBase, 'Renderizando p√°gina ' + i + '/' + totalPages, '');

                const page = await pdfDoc.getPage(i);
                const origVP = page.getViewport({ scale: 1.0 });
                const pageW = origVP.width;
                const pageH = origVP.height;

                // Calcular escala segura
                let renderScale = scale;
                const maxDim = Math.max(origVP.width, origVP.height) * renderScale;
                if (maxDim > CONFIG.MAX_CANVAS_DIM) {
                    renderScale = CONFIG.MAX_CANVAS_DIM / Math.max(origVP.width, origVP.height);
                }

                const renderVP = page.getViewport({ scale: renderScale });
                canvas.width = Math.floor(renderVP.width);
                canvas.height = Math.floor(renderVP.height);

                // Fondo blanco + render
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                await page.render({ canvasContext: ctx, viewport: renderVP }).promise;

                // Capturar imagen
                const imgDataURL = canvas.toDataURL('image/jpeg', quality);
                if (!imgDataURL || imgDataURL.length < 100) {
                    throw new Error('Error al rasterizar la p√°gina ' + i);
                }

                // 3b. OCR
                let ocrData = null;
                if (enableOCR) {
                    const pctOcr = pctBase + (pctEnd - pctBase) * 0.4;
                    setProgress(pctOcr, 'OCR p√°gina ' + i + '/' + totalPages, 'üîç Reconociendo...');
                    ocrData = await runOCR(canvas);

                    if (ocrData && ocrData.words) {
                        const count = ocrData.words.filter(w => w.confidence >= CONFIG.OCR_MIN_CONFIDENCE).length;
                        setProgress(null, null, '‚úì ' + count + ' palabras detectadas');
                    }
                }

                // 3c. Construir p√°gina de salida
                setProgress(pctEnd, 'Construyendo p√°gina ' + i + '...', '');

                if (i === 1) {
                    outPdf = new jsPDF({
                        orientation: pageW > pageH ? 'l' : 'p',
                        unit: 'pt',
                        format: [pageW, pageH],
                        compress: true
                    });
                } else {
                    outPdf.addPage([pageW, pageH], pageW > pageH ? 'l' : 'p');
                }

                // Insertar imagen
                outPdf.addImage(imgDataURL, 'JPEG', 0, 0, pageW, pageH, 'pg' + i, 'FAST');

                // Insertar capa de texto
                if (ocrData) {
                    addTextLayer(outPdf, ocrData, pageW, pageH, canvas.width, canvas.height);
                }

                // Liberar
                page.cleanup();
                await wait(CONFIG.YIELD_DELAY);
            }

            // 4. Generar blob final
            setProgress(92, 'Generando PDF final...', enableOCR ? 'üìù Incrustando texto...' : '');
            await wait(100);

            finalBlob = outPdf.output('blob');

            if (!finalBlob || finalBlob.size === 0) {
                throw new Error('El PDF generado est√° vac√≠o. Intenta con otros ajustes.');
            }

            console.log('‚úÖ PDF generado:', formatSize(finalBlob.size));

            // 5. Mostrar resultados
            const origBytes = selectedFile.size;
            const newBytes = finalBlob.size;
            const saving = ((1 - newBytes / origBytes) * 100).toFixed(0);

            DOM.newSize.textContent = formatSize(newBytes);

            if (saving > 0) {
                DOM.savingsBadge.textContent = '‚Üì ' + saving + '% m√°s peque√±o';
                DOM.savingsBadge.className = 'savings-badge positive';
            } else {
                DOM.savingsBadge.textContent = '‚Üë ' + Math.abs(saving) + '% m√°s grande';
                DOM.savingsBadge.className = 'savings-badge negative';
            }

            DOM.progressFill.classList.add('complete');
            setProgress(100, '‚úì Optimizaci√≥n completa',
                enableOCR ? 'üìã Texto seleccionable y copiable' : '‚úì Listo para descargar');

            // MOSTRAR BOT√ìN DE DESCARGA
            DOM.downloadBtn.classList.add('active');

        } catch (err) {
            console.error('Error procesando:', err);
            showError(err.message || 'Error desconocido al procesar el PDF.');
            DOM.progressFill.classList.add('error');
            setProgress(100, '‚úó Error', err.message || '');
        } finally {
            if (pdfDoc) { try { pdfDoc.destroy(); } catch(e) {} }
            await stopOCR();
            isProcessing = false;
            DOM.processBtn.disabled = !selectedFile;
            DOM.processBtn.classList.remove('processing');
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  DESCARGA
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function downloadResult() {
        if (!finalBlob) {
            showError('No hay archivo para descargar. Procesa un PDF primero.');
            return;
        }

        console.log('üì• Iniciando descarga, tama√±o:', formatSize(finalBlob.size));

        try {
            // Limpiar URL anterior
            if (blobUrl) {
                URL.revokeObjectURL(blobUrl);
                blobUrl = null;
            }

            // Crear nueva URL
            blobUrl = URL.createObjectURL(finalBlob);

            // Crear nombre del archivo
            const baseName = selectedFile.name.replace(/\.pdf$/i, '');
            const suffix = DOM.ocrToggle.checked ? '_optimizado_OCR' : '_optimizado';
            const outputName = baseName + suffix + '.pdf';

            // M√©todo 1: Link invisible
            const link = document.createElement('a');
            link.href = blobUrl;
            link.download = outputName;
            link.style.cssText = 'position:fixed;left:-999px;top:-999px;opacity:0;';
            document.body.appendChild(link);

            // Click
            link.click();

            // Limpiar despu√©s
            setTimeout(() => {
                if (link.parentNode) {
                    document.body.removeChild(link);
                }
            }, 5000);

            console.log('‚úÖ Descarga iniciada:', outputName);

        } catch (err) {
            console.error('Error descargando:', err);

            // M√©todo 2: Fallback - abrir en nueva pesta√±a
            try {
                const fallbackUrl = URL.createObjectURL(finalBlob);
                const win = window.open(fallbackUrl, '_blank');

                if (!win) {
                    showError('El navegador bloque√≥ la ventana. Permite las ventanas emergentes e intenta de nuevo.');
                } else {
                    console.log('‚úÖ Abierto en nueva pesta√±a');
                }
            } catch (e2) {
                showError('No se pudo descargar: ' + (err.message || 'Error desconocido'));
            }
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  EVENTOS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // Archivo
    DOM.fileInput.addEventListener('change', function(e) {
        const file = e.target.files && e.target.files[0];
        if (file) loadFile(file);
    });

    // Click en zona de upload
    DOM.uploadZone.addEventListener('click', function(e) {
        if (e.target === DOM.fileRemove || DOM.fileRemove.contains(e.target)) return;
        if (isProcessing) return;
        DOM.fileInput.click();
    });

    // Teclado
    DOM.uploadZone.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            DOM.fileInput.click();
        }
    });

    // Drag & Drop
    DOM.uploadZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        e.stopPropagation();
        DOM.uploadZone.classList.add('drag-over');
    });

    DOM.uploadZone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        DOM.uploadZone.classList.remove('drag-over');
    });

    DOM.uploadZone.addEventListener('drop', function(e) {
        e.preventDefault();
        e.stopPropagation();
        DOM.uploadZone.classList.remove('drag-over');
        const file = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
        if (file) loadFile(file);
    });

    // Quitar archivo
    DOM.fileRemove.addEventListener('click', function(e) {
        e.stopPropagation();
        e.preventDefault();
        if (!isProcessing) clearFile();
    });

    // Slider de calidad
    DOM.quality.addEventListener('input', function() {
        DOM.qLabel.textContent = this.value + '%';
    });

    // Toggle OCR
    DOM.ocrToggle.addEventListener('change', function() {
        const on = this.checked;
        DOM.ocrPanel.classList.toggle('active', on);
        DOM.ocrExpanded.classList.toggle('active', on);
    });

    // Bot√≥n procesar
    DOM.processBtn.addEventListener('click', function() {
        processDocument();
    });

    // Bot√≥n descargar
    DOM.downloadBtn.addEventListener('click', function() {
        downloadResult();
    });

    // Limpieza al cerrar
    window.addEventListener('beforeunload', function() {
        if (blobUrl) URL.revokeObjectURL(blobUrl);
        stopOCR();
    });

    console.log('üöÄ PDF Forge Pro v2.0 inicializado');

})();
</script>

</body>
</html>