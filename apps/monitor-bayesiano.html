<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Monitor Adaptativo Bayesiano - BioestadisticaEdu</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: transparent; padding: 10px; }
        .card { background: #f0f7ff; border: 1px solid #bee3f8; border-radius: 12px; padding: 25px; max-width: 550px; margin: auto; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        h2 { color: #2b6cb0; font-size: 1.3rem; margin-top: 0; text-align: center; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        label { display: block; font-size: 0.8rem; font-weight: 600; color: #2c5282; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #90cdf4; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; background: #2b6cb0; color: white; border: none; padding: 14px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        #results { margin-top: 20px; padding: 20px; border-radius: 8px; display: none; background: white; border: 2px solid #2b6cb0; text-align: center; }
        .prob-val { font-size: 3rem; font-weight: bold; color: #2b6cb0; margin: 10px 0; }
        .decision { padding: 10px; border-radius: 6px; font-weight: bold; margin-top: 10px; }
        .success { background: #f0fff4; color: #2f855a; }
        .futility { background: #fff5f5; color: #c53030; }
    </style>
</head>
<body>

<div class="card">
    <h2> Monitor Adaptativo Bayesiano</h2>
    <p style="font-size: 0.8rem; text-align: center; color: #4a5568; margin-bottom: 20px;">
        Actualizaci贸n de probabilidad posterior basada en datos interinos.
    </p>

    <div class="grid">
        <div>
            <label>xitos (Tratamiento)</label>
            <input type="number" id="e_t" value="25">
        </div>
        <div>
            <label>N actual (Tratamiento)</label>
            <input type="number" id="n_t" value="40">
        </div>
        <div>
            <label>xitos (Control)</label>
            <input type="number" id="e_c" value="15">
        </div>
        <div>
            <label>N actual (Control)</label>
            <input type="number" id="n_c" value="40">
        </div>
    </div>

    <div class="input-group" style="margin-bottom: 20px;">
        <label>Prior (Informaci贸n previa)</label>
        <select id="prior">
            <option value="uninf">No informativa (Neutral)</option>
            <option value="skeptic">Esc茅ptica (Duda del f谩rmaco)</option>
            <option value="optimist">Optimista (Cree en el f谩rmaco)</option>
        </select>
    </div>

    <button onclick="updatePosterior()">Calcular Probabilidad de Superioridad</button>

    <div id="results">
        <div style="font-size: 0.9rem; font-weight: 600;">Probabilidad Posterior de que T > C:</div>
        <div class="prob-val" id="prob-display">0%</div>
        <div id="decision-box" class="decision"></div>
        <p style="font-size: 0.7rem; color: #a0aec0; margin-top: 15px;">
            Simulaci贸n mediante distribuci贸n Beta-Binomial. <br>
            BioestadisticaEdu 漏 2025 - Mohsen Ebrahimi
        </p>
    </div>
</div>

<script>
// Funci贸n para simular la posterior usando aproximaci贸n (Beta-Binomial)
function updatePosterior() {
    const et = parseInt(document.getElementById('e_t').value);
    const nt = parseInt(document.getElementById('n_t').value);
    const ec = parseInt(document.getElementById('e_c').value);
    const nc = parseInt(document.getElementById('n_c').value);
    const priorType = document.getElementById('prior').value;

    // Par谩metros de la Beta Prior (Alpha, Beta)
    let at = 1, bt = 1, ac = 1, bc = 1;
    if (priorType === 'skeptic') { at = 1; bt = 2; }
    if (priorType === 'optimist') { at = 2; bt = 1; }

    // Actualizaci贸n Bayesiana (Posterior)
    const post_at = at + et;
    const post_bt = bt + (nt - et);
    const post_ac = ac + ec;
    const post_bc = bc + (nc - ec);

    // Simulaci贸n Monte Carlo simple (10,000 iteraciones) para comparar proporciones
    let superiorCount = 0;
    for (let i = 0; i < 10000; i++) {
        if (sampleBeta(post_at, post_bt) > sampleBeta(post_ac, post_bc)) {
            superiorCount++;
        }
    }

    const prob = (superiorCount / 10000);
    const probPct = (prob * 100).toFixed(1);

    document.getElementById('results').style.display = 'block';
    document.getElementById('prob-display').innerText = probPct + "%";

    const dBox = document.getElementById('decision-box');
    if (prob > 0.95) {
        dBox.innerText = "ALTA PROBABILIDAD DE XITO: Considerar parada temprana.";
        dBox.className = "decision success";
    } else if (prob < 0.10) {
        dBox.innerText = "FUTILIDAD: Probabilidad muy baja de 茅xito final.";
        dBox.className = "decision futility";
    } else {
        dBox.innerText = "CONTINUAR: Seguir reclutando seg煤n protocolo.";
        dBox.className = "decision";
        dBox.style.background = "#edf2f7";
    }
}

// Generador de muestras Beta (Marsaglia)
function sampleBeta(alpha, beta) {
    function rgamma(a) {
        let x = 0;
        for (let i = 0; i < a; i++) x -= Math.log(Math.random());
        return x;
    }
    const x = rgamma(alpha);
    const y = rgamma(beta);
    return x / (x + y);
}
</script>
</body>
</html>